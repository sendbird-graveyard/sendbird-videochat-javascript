!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define("SendBirdVideoChat",[],n):"object"==typeof exports?exports.SendBirdVideoChat=n():e.SendBirdVideoChat=n()}("undefined"!=typeof self?self:this,function(){return function(e){var n={};function t(r){if(n[r])return n[r].exports;var a=n[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,t),a.l=!0,a.exports}return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var a in e)t.d(r,a,function(n){return e[n]}.bind(null,a));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=2)}([function(e,n){!function(){var n,t,r,a,i,o,l,c,u,s,d,f,h,v,p,C,g,y,m,E,b,O,R,A,I,S,w,_,k,N,P,T,D,L,V,x,M,U,B,j,F,G,H,W,Q,X,J,K,q,z,Z,Y,$,ee,ne,te,re=32768,ae=0,ie=1,oe=2,le=6,ce=!1,ue=8192,se=2*re,de=3,fe=258,he=8192,ve=he,pe=32768,Ce=pe-1,ge=re-1,ye=0,me=4096,Ee=fe+de+1,be=re-Ee,Oe=1,Re=15,Ae=7,Ie=29,Se=256,we=256,_e=Se+1+Ie,ke=30,Ne=19,Pe=16,Te=17,De=18,Le=2*_e+1,Ve=parseInt((15+de-1)/de,10),xe=null;function Me(){this.fc=0,this.dl=0}function Ue(){this.dyn_tree=null,this.static_tree=null,this.extra_bits=null,this.extra_base=0,this.elems=0,this.max_length=0,this.max_code=0}function Be(e,n,t,r){this.good_length=e,this.max_lazy=n,this.nice_length=t,this.max_chain=r}function je(){this.next=null,this.len=0,this.ptr=[],this.off=0}var Fe=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Ge=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],He=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],We=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Qe=[new Be(0,0,0,0),new Be(4,4,8,4),new Be(4,5,16,8),new Be(4,6,32,32),new Be(4,4,16,16),new Be(8,16,32,32),new Be(8,16,128,128),new Be(8,32,128,256),new Be(32,128,258,1024),new Be(32,258,258,4096)];function Xe(e){e.next=n,n=e}function Je(e){return d[re+e]}function Ke(e,n){return d[re+e]=n}function qe(e){xe[o+i++]=e,o+i===ue&&function(){var e,a;if(0!==i){for(null!==n?(l=n,n=n.next):l=new je,l.next=null,l.len=l.off=0,e=l,null===t?t=r=e:r=r.next=e,e.len=i-o,a=0;a<e.len;a++)e.ptr[a]=xe[o+a];i=o=0}var l}()}function ze(e){e&=65535,o+i<ue-2?(xe[o+i++]=255&e,xe[o+i++]=e>>>8):(qe(255&e),qe(e>>>8))}function Ze(){p=(p<<Ve^255&c[b+de-1])&Ce,C=Je(p),d[b&ge]=C,Ke(p,b)}function Ye(e,n){yn(n[e].fc,n[e].dl)}function $e(e){return 255&(e<256?W[e]:W[256+(e>>7)])}function en(e,n,t){return e[n].fc<e[t].fc||e[n].fc===e[t].fc&&G[n]<=G[t]}function nn(e,n,t){var r;for(r=0;r<t&&te<ne.length;r++)e[n+r]=255&ne[te++];return r}function tn(e){var n,t,r,a,i=I,o=b,l=E,u=b>be?b-be:ye,s=b+fe,f=c[o+l-1],h=c[o+l];E>=_&&(i>>=2);do{if(c[(n=e)+l]===h&&c[n+l-1]===f&&c[n]===c[o]&&c[++n]===c[o+1]){for(o+=2,n++;o<s;){for(a=!1,r=0;r<8;r+=1)if(n+=1,c[o+=1]!==c[n]){a=!0;break}if(a)break}if(t=fe-(s-o),o=s-fe,t>l){if(O=e,l=t,ce){if(t>=fe)break}else if(t>=k)break;f=c[o+l-1],h=c[o+l]}}}while((e=d[e&ge])>u&&0!=--i);return l}function rn(){var e,n,t=se-A-b;if(-1===t)t--;else if(b>=re+be){for(e=0;e<re;e++)c[e]=c[e+re];for(O-=re,b-=re,v-=re,e=0;e<pe;e++)Ke(e,(n=Je(e))>=re?n-re:ye);for(e=0;e<re;e++)n=d[e],d[e]=n>=re?n-re:ye;t+=re}R||((e=nn(c,b+A,t))<=0?R=!0:A+=e)}function an(){R||(f=0,h=0,function(){var e,n,t,r,a;if(0!==D[0].dl)return;for(V.dyn_tree=N,V.static_tree=T,V.extra_bits=Fe,V.extra_base=Se+1,V.elems=_e,V.max_length=Re,V.max_code=0,x.dyn_tree=P,x.static_tree=D,x.extra_bits=Ge,x.extra_base=0,x.elems=ke,x.max_length=Re,x.max_code=0,M.dyn_tree=L,M.static_tree=null,M.extra_bits=He,M.extra_base=0,M.elems=Ne,M.max_length=Ae,M.max_code=0,t=0,r=0;r<Ie-1;r++)for(Q[r]=t,e=0;e<1<<Fe[r];e++)H[t++]=r;for(H[t-1]=r,a=0,r=0;r<16;r++)for(X[r]=a,e=0;e<1<<Ge[r];e++)W[a++]=r;for(a>>=7;r<ke;r++)for(X[r]=a<<7,e=0;e<1<<Ge[r]-7;e++)W[256+a++]=r;for(n=0;n<=Re;n++)U[n]=0;e=0;for(;e<=143;)T[e++].dl=8,U[8]++;for(;e<=255;)T[e++].dl=9,U[9]++;for(;e<=279;)T[e++].dl=7,U[7]++;for(;e<=287;)T[e++].dl=8,U[8]++;for(sn(T,_e+1),e=0;e<ke;e++)D[e].dl=5,D[e].fc=mn(e,5);cn()}(),function(){var e;for(e=0;e<pe;e++)d[re+e]=0;if(S=Qe[w].max_lazy,_=Qe[w].good_length,ce||(k=Qe[w].nice_length),I=Qe[w].max_chain,b=0,v=0,(A=nn(c,0,2*re))<=0)return R=!0,void(A=0);for(R=!1;A<Ee&&!R;)rn();for(p=0,e=0;e<de-1;e++)p=(p<<Ve^255&c[e])&Ce}(),t=null,i=0,o=0,w<=3?(E=de-1,m=0):(m=de-1,y=!1),l=!1)}function on(e,n,r){var i;return a||(an(),a=!0,0!==A)?(i=ln(e,n,r))===r?r:l?i:(w<=3?function(){for(;0!==A&&null===t;){var e;if(Ze(),C!==ye&&b-C<=be&&(m=tn(C))>A&&(m=A),m>=de)if(e=pn(b-O,m-de),A-=m,m<=S){m--;do{b++,Ze()}while(0!=--m);b++}else b+=m,m=0,p=((p=255&c[b])<<Ve^255&c[b+1])&Ce;else e=pn(0,255&c[b]),A--,b++;for(e&&(vn(0),v=b);A<Ee&&!R;)rn()}}():function(){for(;0!==A&&null===t;){if(Ze(),E=m,g=O,m=de-1,C!==ye&&E<S&&b-C<=be&&((m=tn(C))>A&&(m=A),m===de&&b-O>me&&m--),E>=de&&m<=E){var e;e=pn(b-1-g,E-de),A-=E-1,E-=2;do{b++,Ze()}while(0!=--E);y=!1,m=de-1,b++,e&&(vn(0),v=b)}else y?(pn(0,255&c[b-1])&&(vn(0),v=b),b++,A--):(y=!0,b++,A--);for(;A<Ee&&!R;)rn()}}(),0===A&&(y&&pn(0,255&c[b-1]),vn(1),l=!0),i+ln(e,i+n,r-i)):(l=!0,0)}function ln(e,n,r){var a,l,c;for(a=0;null!==t&&a<r;){for((l=r-a)>t.len&&(l=t.len),c=0;c<l;c++)e[n+a+c]=t.ptr[t.off+c];var u;if(t.off+=l,t.len-=l,a+=l,0===t.len)u=t,t=t.next,Xe(u)}if(a===r)return a;if(o<i){for((l=r-a)>i-o&&(l=i-o),c=0;c<l;c++)e[n+a+c]=xe[o+c];a+=l,i===(o+=l)&&(i=o=0)}return a}function cn(){var e;for(e=0;e<_e;e++)N[e].fc=0;for(e=0;e<ke;e++)P[e].fc=0;for(e=0;e<Ne;e++)L[e].fc=0;N[we].fc=1,$=ee=0,K=q=z=0,Z=0,Y=1}function un(e,n){for(var t=B[n],r=n<<1;r<=j&&(r<j&&en(e,B[r+1],B[r])&&r++,!en(e,t,B[r]));)B[n]=B[r],n=r,r<<=1;B[n]=t}function sn(e,n){var t,r,a=[],i=0;for(t=1;t<=Re;t++)i=i+U[t-1]<<1,a[t]=i;for(r=0;r<=n;r++){var o=e[r].dl;0!==o&&(e[r].fc=mn(a[o]++,o))}}function dn(e){var n,t,r=e.dyn_tree,a=e.static_tree,i=e.elems,o=-1,l=i;for(j=0,F=Le,n=0;n<i;n++)0!==r[n].fc?(B[++j]=o=n,G[n]=0):r[n].dl=0;for(;j<2;){var c=B[++j]=o<2?++o:0;r[c].fc=1,G[c]=0,$--,null!==a&&(ee-=a[c].dl)}for(e.max_code=o,n=j>>1;n>=1;n--)un(r,n);do{n=B[Oe],B[Oe]=B[j--],un(r,Oe),t=B[Oe],B[--F]=n,B[--F]=t,r[l].fc=r[n].fc+r[t].fc,G[n]>G[t]+1?G[l]=G[n]:G[l]=G[t]+1,r[n].dl=r[t].dl=l,B[Oe]=l++,un(r,Oe)}while(j>=2);B[--F]=B[Oe],function(e){var n,t,r,a,i,o,l=e.dyn_tree,c=e.extra_bits,u=e.extra_base,s=e.max_code,d=e.max_length,f=e.static_tree,h=0;for(a=0;a<=Re;a++)U[a]=0;for(l[B[F]].dl=0,n=F+1;n<Le;n++)(a=l[l[t=B[n]].dl].dl+1)>d&&(a=d,h++),l[t].dl=a,t>s||(U[a]++,i=0,t>=u&&(i=c[t-u]),o=l[t].fc,$+=o*(a+i),null!==f&&(ee+=o*(f[t].dl+i)));if(0!==h){do{for(a=d-1;0===U[a];)a--;U[a]--,U[a+1]+=2,U[d]--,h-=2}while(h>0);for(a=d;0!==a;a--)for(t=U[a];0!==t;)(r=B[--n])>s||(l[r].dl!==a&&($+=(a-l[r].dl)*l[r].fc,l[r].fc=a),t--)}}(e),sn(r,o)}function fn(e,n){var t,r,a=-1,i=e[0].dl,o=0,l=7,c=4;for(0===i&&(l=138,c=3),e[n+1].dl=65535,t=0;t<=n;t++)r=i,i=e[t+1].dl,++o<l&&r===i||(o<c?L[r].fc+=o:0!==r?(r!==a&&L[r].fc++,L[Pe].fc++):o<=10?L[Te].fc++:L[De].fc++,o=0,a=r,0===i?(l=138,c=3):r===i?(l=6,c=3):(l=7,c=4))}function hn(e,n){var t,r,a=-1,i=e[0].dl,o=0,l=7,c=4;for(0===i&&(l=138,c=3),t=0;t<=n;t++)if(r=i,i=e[t+1].dl,!(++o<l&&r===i)){if(o<c)do{Ye(r,L)}while(0!=--o);else 0!==r?(r!==a&&(Ye(r,L),o--),Ye(Pe,L),yn(o-3,2)):o<=10?(Ye(Te,L),yn(o-3,3)):(Ye(De,L),yn(o-11,7));o=0,a=r,0===i?(l=138,c=3):r===i?(l=6,c=3):(l=7,c=4)}}function vn(e){var n,t,r,a,i;if(a=b-v,J[z]=Z,dn(V),dn(x),r=function(){var e;for(fn(N,V.max_code),fn(P,x.max_code),dn(M),e=Ne-1;e>=3&&0===L[We[e]].dl;e--);return $+=3*(e+1)+5+5+4,e}(),(t=ee+3+7>>3)<=(n=$+3+7>>3)&&(n=t),a+4<=n&&v>=0)for(yn((ae<<1)+e,3),En(),ze(a),ze(~a),i=0;i<a;i++)qe(c[v+i]);else t===n?(yn((ie<<1)+e,3),Cn(T,D)):(yn((oe<<1)+e,3),function(e,n,t){var r;for(yn(e-257,5),yn(n-1,5),yn(t-4,4),r=0;r<t;r++)yn(L[We[r]].dl,3);hn(N,e-1),hn(P,n-1)}(V.max_code+1,x.max_code+1,r+1),Cn(N,P));cn(),0!==e&&En()}function pn(e,n){if(s[K++]=n,0===e?N[n].fc++:(e--,N[H[n]+Se+1].fc++,P[$e(e)].fc++,u[q++]=e,Z|=Y),Y<<=1,0==(7&K)&&(J[z++]=Z,Z=0,Y=1),w>2&&0==(4095&K)){var t,r=8*K,a=b-v;for(t=0;t<ke;t++)r+=P[t].fc*(5+Ge[t]);if(r>>=3,q<parseInt(K/2,10)&&r<parseInt(a/2,10))return!0}return K===he-1||q===ve}function Cn(e,n){var t,r,a,i,o=0,l=0,c=0,d=0;if(0!==K)do{0==(7&o)&&(d=J[c++]),r=255&s[o++],0==(1&d)?Ye(r,e):(Ye((a=H[r])+Se+1,e),0!==(i=Fe[a])&&yn(r-=Q[a],i),Ye(a=$e(t=u[l++]),n),0!==(i=Ge[a])&&yn(t-=X[a],i)),d>>=1}while(o<K);Ye(we,e)}var gn=16;function yn(e,n){h>gn-n?(ze(f|=e<<h),f=e>>gn-h,h+=n-gn):(f|=e<<h,h+=n)}function mn(e,n){var t=0;do{t|=1&e,e>>=1,t<<=1}while(--n>0);return t>>1}function En(){h>8?ze(f):h>0&&qe(f),f=0,h=0}e.exports.deflate=function(e,i){var o,l;ne=e,te=0,function(e){var i;if(e?e<1?e=1:e>9&&(e=9):e=le,w=e,a=!1,R=!1,null===xe){for(n=t=r=null,xe=[],c=[],u=[],s=[],d=[],N=[],i=0;i<Le;i++)N[i]=new Me;for(P=[],i=0;i<2*ke+1;i++)P[i]=new Me;for(T=[],i=0;i<_e+2;i++)T[i]=new Me;for(D=[],i=0;i<ke;i++)D[i]=new Me;for(L=[],i=0;i<2*Ne+1;i++)L[i]=new Me;V=new Ue,x=new Ue,M=new Ue,U=[],B=[],G=[],H=[],W=[],Q=[],X=[],J=[]}}(le),l=[];do{o=on(l,l.length,1024)}while(o>0);return ne=null,l},e.exports.DEFAULT_LEVEL=le}()},function(e,n){!function(){var n,t,r,a,i,o,l,c,u,s,d,f,h,v,p,C,g,y=32768,m=0,E=1,b=2,O=9,R=6,A=null,I=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],S=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],w=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],_=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],k=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function P(){this.next=null,this.list=null}function T(){this.e=0,this.b=0,this.n=0,this.t=null}function D(e,n,t,r,a,i){var o;this.BMAX=16,this.N_MAX=288,this.status=0,this.root=null,this.m=0;var l,c,u,s,d,f,h,v,p,C,g,y,m,E,b,O,R=[],A=[],I=new T,S=[],w=[],_=[];for(O=this.root=null,d=0;d<this.BMAX+1;d++)R[d]=0;for(d=0;d<this.BMAX+1;d++)A[d]=0;for(d=0;d<this.BMAX;d++)S[d]=null;for(d=0;d<this.N_MAX;d++)w[d]=0;for(d=0;d<this.BMAX+1;d++)_[d]=0;l=n>256?e[256]:this.BMAX,v=e,p=0,d=n;do{R[v[p]]++,p++}while(--d>0);if(R[0]===n)return this.root=null,this.m=0,void(this.status=0);for(f=1;f<=this.BMAX&&0===R[f];f++);for(h=f,i<f&&(i=f),d=this.BMAX;0!==d&&0===R[d];d--);for(u=d,i>d&&(i=d),m=1<<f;f<d;f++,m<<=1)if((m-=R[f])<0)return this.status=2,void(this.m=i);if((m-=R[d])<0)return this.status=2,void(this.m=i);for(R[d]+=m,_[1]=f=0,v=R,p=1,y=2;--d>0;)_[y++]=f+=v[p++];v=e,p=0,d=0;do{0!==(f=v[p++])&&(w[_[f]++]=d)}while(++d<n);for(n=_[u],_[0]=d=0,v=w,p=0,s=-1,g=A[0]=0,C=null,E=0;h<=u;h++)for(o=R[h];o-- >0;){for(;h>g+A[1+s];){if(g+=A[1+s],s++,E=(E=u-g)>i?i:E,(c=1<<(f=h-g))>o+1)for(c-=o+1,y=h;++f<E&&!((c<<=1)<=R[++y]);)c-=R[y];for(g+f>l&&g<l&&(f=l-g),E=1<<f,A[1+s]=f,C=[],b=0;b<E;b++)C[b]=new T;(O=O?O.next=new P:this.root=new P).next=null,O.list=C,S[s]=C,s>0&&(_[s]=d,I.b=A[s],I.e=16+f,I.t=C,f=(d&(1<<g)-1)>>g-A[s],S[s-1][f].e=I.e,S[s-1][f].b=I.b,S[s-1][f].n=I.n,S[s-1][f].t=I.t)}for(I.b=h-g,p>=n?I.e=99:v[p]<t?(I.e=v[p]<256?16:15,I.n=v[p++]):(I.e=a[v[p]-t],I.n=r[v[p++]-t]),c=1<<h-g,f=d>>g;f<E;f+=c)C[f].e=I.e,C[f].b=I.b,C[f].n=I.n,C[f].t=I.t;for(f=1<<h-1;0!=(d&f);f>>=1)d^=f;for(d^=f;(d&(1<<g)-1)!==_[s];)g-=A[s],s--}this.m=A[1],this.status=0!==m&&1!==u?1:0}function L(e){for(;l<e;)o|=(C.length===g?-1:255&C[g++])<<l,l+=8}function V(e){return o&I[e]}function x(e){o>>=e,l-=e}function M(e,r,a){var i,o,l;if(0===a)return 0;for(l=0;;){for(L(v),i=(o=f.list[V(v)]).e;i>16;){if(99===i)return-1;x(o.b),L(i-=16),i=(o=o.t[V(i)]).e}if(x(o.b),16!==i){if(15===i)break;for(L(i),s=o.n+V(i),x(i),L(p),i=(o=h.list[V(p)]).e;i>16;){if(99===i)return-1;x(o.b),L(i-=16),i=(o=o.t[V(i)]).e}for(x(o.b),L(i),d=t-o.n-V(i),x(i);s>0&&l<a;)s--,d&=y-1,t&=y-1,e[r+l++]=n[t++]=n[d++];if(l===a)return a}else if(t&=y-1,e[r+l++]=n[t++]=o.n,l===a)return a}return c=-1,l}function U(e,r,a){var i;if(x(i=7&l),L(16),i=V(16),x(16),L(16),i!==(65535&~o))return-1;for(x(16),s=i,i=0;s>0&&i<a;)s--,t&=y-1,L(8),e[r+i++]=n[t++]=V(8),x(8);return 0===s&&(c=-1),i}function B(e,n,t){if(!A){var o,l,c=[];for(o=0;o<144;o++)c[o]=8;for(;o<256;o++)c[o]=9;for(;o<280;o++)c[o]=7;for(;o<288;o++)c[o]=8;if(0!==(l=new D(c,288,257,S,w,a=7)).status)return-1;for(A=l.root,a=l.m,o=0;o<30;o++)c[o]=5;if((l=new D(c,30,0,_,k,i=5)).status>1)return A=null,-1;r=l.root,i=l.m}return f=A,h=r,v=a,p=i,M(e,n,t)}function j(e,n,t){var r,a,i,o,l,c,u,s,d,C=[];for(r=0;r<316;r++)C[r]=0;if(L(5),u=257+V(5),x(5),L(5),s=1+V(5),x(5),L(4),c=4+V(4),x(4),u>286||s>30)return-1;for(a=0;a<c;a++)L(3),C[N[a]]=V(3),x(3);for(;a<19;a++)C[N[a]]=0;if(0!==(d=new D(C,19,19,null,null,v=7)).status)return-1;for(f=d.root,v=d.m,o=u+s,r=i=0;r<o;)if(L(v),x(a=(l=f.list[V(v)]).b),(a=l.n)<16)C[r++]=i=a;else if(16===a){if(L(2),a=3+V(2),x(2),r+a>o)return-1;for(;a-- >0;)C[r++]=i}else if(17===a){if(L(3),a=3+V(3),x(3),r+a>o)return-1;for(;a-- >0;)C[r++]=0;i=0}else{if(L(7),a=11+V(7),x(7),r+a>o)return-1;for(;a-- >0;)C[r++]=0;i=0}if(d=new D(C,u,257,S,w,v=O),0===v&&(d.status=1),0!==d.status&&1!==d.status)return-1;for(f=d.root,v=d.m,r=0;r<s;r++)C[r]=C[r+u];return d=new D(C,s,0,_,k,p=R),h=d.root,0===(p=d.m)&&u>257?-1:0!==d.status?-1:M(e,n,t)}function F(e,r,a){var i,o;for(i=0;i<a;){if(u&&-1===c)return i;if(s>0){if(c!==m)for(;s>0&&i<a;)s--,d&=y-1,t&=y-1,e[r+i++]=n[t++]=n[d++];else{for(;s>0&&i<a;)s--,t&=y-1,L(8),e[r+i++]=n[t++]=V(8),x(8);0===s&&(c=-1)}if(i===a)return i}if(-1===c){if(u)break;L(1),0!==V(1)&&(u=!0),x(1),L(2),c=V(2),x(2),f=null,s=0}switch(c){case m:o=U(e,r+i,a-i);break;case E:o=f?M(e,r+i,a-i):B(e,r+i,a-i);break;case b:o=f?M(e,r+i,a-i):j(e,r+i,a-i);break;default:o=-1}if(-1===o)return u?0:-1;i+=o}return i}e.exports.inflate=function(e){var r,a=[];n||(n=[]),t=0,o=0,l=0,c=-1,u=!1,s=d=0,f=null,C=e,g=0;do{r=F(a,a.length,1024)}while(r>0);return C=null,a}}()},function(e,n,t){e.exports=t(3)},function(e,n,t){"use strict";function r(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}t.r(n);var a={OFF:"OFF",ERROR:"ERROR",INFO:"INFO",TRACE:"TRACE",ALL:"ALL"},i={OFF:{level:0,name:a.OFF},ERROR:{level:1,name:a.ERROR},INFO:{level:4,name:a.INFO},TRACE:{level:5,name:a.TRACE},ALL:{level:999,name:a.ALL}},o=new(function(){function e(){for(var n in function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),a)this[n]=a[n];var t=a.OFF;Object.defineProperty(this,"level",{get:function(){return t},set:function(e){a[e]&&(t=a[e])}});var r="";Object.defineProperty(this,"messagePrefix",{get:function(){return r},set:function(e){"string"==typeof e&&(r=e)}})}var n,t,o;return n=e,(t=[{key:"_enabledFor",value:function(e){try{return i[this.level].level>=i[e].level}catch(e){return!1}}},{key:"_permit",value:function(e){var n=e===a.INFO||a.TRACE?"log":e.toLowerCase();if(this._enabledFor(e)&&console&&console[n]){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];var o,l;if("string"==typeof r[0])r[0]=this.messagePrefix+r[0],(o=console)[n].apply(o,r);else(l=console)[n].apply(l,[this.messagePrefix].concat(r))}}},{key:"trace",value:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];this._permit.apply(this,[a.TRACE].concat(n))}},{key:"info",value:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];this._permit.apply(this,[a.INFO].concat(n))}},{key:"error",value:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];this._permit.apply(this,[a.ERROR].concat(n))}}])&&r(n.prototype,t),o&&r(n,o),e}());function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var c=function(e){return"boolean"==typeof e},u=function(e){return"number"==typeof e},s=function(e){return"string"==typeof e},d=function(e){return void 0===e},f=function(e){return"function"==typeof e},h=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!f(e))return n?Promise.reject(n):Promise.resolve(t);n?e(n):e(n,t)},v=function e(){for(var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=0;t<(arguments.length<=1?0:arguments.length-1);t++){var r=t+1<1||arguments.length<=t+1?void 0:arguments[t+1];if(r)for(var a in r)r.hasOwnProperty(a)&&("object"===l(r[a])?n[a]=e(n[a],r[a]):n[a]=r[a])}return n};function p(e,n,t,r,a,i,o){try{var l=e[i](o),c=l.value}catch(e){return void t(e)}l.done?n(c):Promise.resolve(c).then(r,a)}function C(e){return function(){var n=this,t=arguments;return new Promise(function(r,a){var i=e.apply(n,t);function o(e){p(i,r,a,o,l,"next",e)}function l(e){p(i,r,a,o,l,"throw",e)}o(void 0)})}}var g=function(){var e=C(regeneratorRuntime.mark(function e(n){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.audio,r=n.video,e.prev=1,e.next=4,navigator.mediaDevices.getUserMedia({audio:t,video:r});case 4:return e.abrupt("return",e.sent);case 7:throw e.prev=7,e.t0=e.catch(1),e.t0;case 10:case"end":return e.stop()}},e,null,[[1,7]])}));return function(n){return e.apply(this,arguments)}}(),y=t(0),m=t(1),E=function(){for(var e=[],n=0;n<256;n++){for(var t=n,r=0;r<8;r++)1&t?t=3988292384^t>>>1:t>>>=1;e[n]=t>>>0}return e}(),b=function(e){return(function(e){for(var n=-1,t=0;t<e.length;t++)n=n>>>8^E[255&(n^e[t])];return-1^n}(e)>>>0).toString(16)},O=function(e,n){n.push(255&e)},R=function(e,n){n.push(255&e),n.push(e>>>8)},A=function(e,n){R(65535&e,n),R(e>>>16,n)},I=function(e){return e.shift()},S=function(e){return e.shift()|e.shift()<<8},w=function(e){var n=S(e),t=S(e);return t>32768?((t-=32768)<<16|n)+32768*Math.pow(2,16):t<<16|n},_="undefined"!=typeof Uint8Array?Uint8Array:Array,k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",N=function(){for(var e=k.length,n=[],t=[],r=0;r<e;r++)n[r]=k[r],t[k.charCodeAt(r)]=r;return t["-".charCodeAt(0)]=62,t["_".charCodeAt(0)]=63,{lookup:n,revLookup:t}}(),P=N.lookup,T=N.revLookup,D=function(e){for(var n=function(e){var n=e.length;if(n%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=-1===e.indexOf("=")?n:e.indexOf("=");return{validLen:t,placeHoldersLen:t===n?0:4-t%4}}(e=e.replace(/(\r\n|\n|\r)/gm,"")),t=n.validLen,r=n.placeHoldersLen,a=new _(function(e,n){return 3*(e+n)/4-n}(t,r)),i=0,o=r>0?t-4:t,l=0;l<o;l+=4){var c=T[e.charCodeAt(l)]<<18|T[e.charCodeAt(l+1)]<<12|T[e.charCodeAt(l+2)]<<6|T[e.charCodeAt(l+3)];a[i++]=c>>16&255,a[i++]=c>>8&255,a[i++]=255&c}if(2===r){var u=T[e.charCodeAt(l)]<<2|T[e.charCodeAt(l+1)]>>4;a[i++]=255&u}if(1===r){var s=T[e.charCodeAt(l)]<<10|T[e.charCodeAt(l+1)]<<4|T[e.charCodeAt(l+2)]>>2;a[i++]=s>>8&255,a[i++]=255&s}return a},L=function(e,n,t){for(var r,a=[],i=n;i<t;i+=3){var o=(e[i]<<16&16711680)+(e[i+1]<<8&65280)+(255&e[i+2]);a.push(P[(r=o)>>18&63]+P[r>>12&63]+P[r>>6&63]+P[63&r])}return a.join("")},V=function(e){return function(e){for(var n=[],t=e.length,r=t%3,a=t-r,i=0;i<a;i+=16383){var o=i+16383>a?a:i+16383;n.push(L(e,i,o))}if(1===r){var l=e[t-1];n.push(P[l>>2]+P[l<<4&63]+"==")}else if(2===r){var c=(e[t-2]<<8)+e[t-1];n.push(P[c>>10]+P[c>>4&63]+P[c<<2&63]+"=")}return n.join("")}(function(e){var n=[];return s(e)&&(e=Array.prototype.map.call(e,function(e){return e.charCodeAt(0)})),O(31,n),O(139,n),O(8,n),O(0,n),A(parseInt(Date.now()/1e3,10),n),O(0,n),O(3,n),Object(y.deflate)(e,6).forEach(function(e){return O(e,n)}),A(parseInt(b(e),16),n),A(e.length,n),n}(e))},x=function(e){var n=function(e){for(var n=Array.prototype.slice.call(e,0),t=0;t<n.length;t++)n[t]=n[t]<0?n[t]+256:n[t];var r=I(n),a=I(n);if(31!==r||139!==a)throw"Not a GZIP file";if(8!==I(n))throw"Unsupported compression method";I(n),w(n),I(n),I(n);var i=Object(m.inflate)(n.splice(0,n.length-8));if(w(n)>>>0!==parseInt(b(i),16))throw"Checksum does not match";if(w(n)!==i.length)throw"Size of decompressed file not correct";return i}(D(e));return n.map(function(e){return String.fromCharCode(e)}).join("")},M={UNKNOWN:{code:82e4,message:"Unknown error occurred."},SENDBIRD_CONNECTION_REQUIRED:{code:820100,message:"SendBird connection is required."},SENDBIRD_REQUIRED:{code:820130,message:"SendBird instance is required."},INVALID_ACTION:{code:820200,message:"Invalid action."},USER_MESSAGE_REQUIRED:{code:820201,message:"VideoChat UserMessage must be required."},ACCEPTING_FAIL:{code:820300,message:"Can not accept call."},INVALID_PARAMETER:{code:820400,message:"Invalid parameter."},UNSUITABLE_CHANNEL:{code:820401,message:"The channel is not suitable."},CALL_ON_GOING:{code:900600,message:"Call is already going on in this channel."},NO_CALL_GOING_ON:{code:900601,message:"There is no call going on in this channel."},INVALID_LOCAL_VIDEO_ELEMENT:{code:820530,message:"The local video element is not valid."},INVALID_DEVICE_ID:{code:820531,message:"The deviceId must be a string."},UNSUITABLE_CALL:{code:820532,message:"Only active call can change media devices."}},U=" (Another call cannot be accepted while an active call is in progress.)",B=" (Only callees (call recipients) can accept calls.)",j=" (Another call cannot be started while an active call is in progress.)",F=" (The call is already ended.)",G=" (Only callee (call recipients) and caller (call requester) can end calls.)",H=" (CallOptions cannot be null.)",W=" (CallOptions type is not valid.)",Q=" (ChannelUrl of CallOptions must be a string.)",X=" (isAudioCall must be a boolean.)",J=v({},M);function K(e){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function q(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function z(e,n){return!n||"object"!==K(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function Z(e){var n="function"==typeof Map?new Map:void 0;return(Z=function(e){if(null===e||(t=e,-1===Function.toString.call(t).indexOf("[native code]")))return e;var t;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,r)}function r(){return Y(e,arguments,ee(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),$(r,e)})(e)}function Y(e,n,t){return(Y=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,n,t){var r=[null];r.push.apply(r,n);var a=new(Function.bind.apply(e,r));return t&&$(a,t.prototype),a}).apply(null,arguments)}function $(e,n){return($=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function ee(e){return(ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}delete J.USER_MESSAGE_REQUIRED,delete J.NO_CALL_GOING_ON;var ne="VideoChatException",te=function(e){function n(e){var t,r=e.message,a=e.code;return function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),(t=z(this,ee(n).call(this))).message=r,t.name=ne,t.code=a||0,t}var t,r,a;return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&$(e,n)}(n,Z(Error)),t=n,a=[{key:"create",value:function(){return new n(arguments.length>0&&void 0!==arguments[0]?arguments[0]:M.UNKNOWN)}},{key:"throw",value:function(e){var t=e.error,r=e.message,a=e.code,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(r&&a&&(t=new n({message:r+i,code:a})),t instanceof n)throw t}},{key:"ErrorCode",get:function(){var e={};for(var n in J)e[n]=M[n].code;return e}}],(r=null)&&q(t.prototype,r),a&&q(t,a),n}();var re=function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.onStartSent=function(e,n){},this.onStartReceived=function(e){},this.onAcceptSent=function(e){},this.onAcceptReceived=function(e){},this.onEndSent=function(e,n){},this.onEndReceived=function(e){},this.onOpened=function(e){},this.onDropped=function(e){},this.onReopened=function(e){},this.onOpponentAudioStateChanged=function(e){},this.onOpponentVideoStateChanged=function(e){}},ae={START:"start"},ie={END:"end",DECLINE:"decline",CANCEL:"cancel",TIMEOUT:"timeout",RECONNECT_TIMEOUT:"reconnect_timeout",UNKNOWN:"unknown"},oe={OFFER:"offer",ANSWER:"answer",CANDIDATE:"candidate",AUDIO:"audio",VIDEO:"video"},le={SGNL:"SGNL",STCA:"STCA",ENCA:"ENCA"},ce="SB_VIDEOCHAT",ue="SB_VIDEOCHAT";var se=function e(n){var t=n.user_id,r=n.nickname,a=n.profile_url,i=n.is_audio_enabled,o=void 0!==i&&i,l=n.is_video_enabled,u=void 0!==l&&l;if(function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),t&&r&&a){var d=t;Object.defineProperty(this,"userId",{get:function(){return d}});var f="";Object.defineProperty(this,"nickname",{get:function(){return f},set:function(e){s(e)&&(f=e)}}),this.nickname=r;var h="";Object.defineProperty(this,"profileUrl",{get:function(){return h},set:function(e){s(e)&&(h=e)}}),this.profileUrl=a;var v=o;Object.defineProperty(this,"isAudioEnabled",{get:function(){return v},set:function(e){c(e)&&(v=e)}});var p=u;Object.defineProperty(this,"isVideoEnabled",{get:function(){return p},set:function(e){c(e)&&(p=e)}})}else te.throw(M.USER_MESSAGE_REQUIRED)};function de(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var fe=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.channelUrl,r=void 0===t?"":t,a=n.localVideoElement,i=void 0===a?null:a,o=n.remoteVideoElement,l=void 0===o?null:o,d=n.isVideoEnabled,f=void 0===d||d,h=n.isAudioEnabled,v=void 0===h||h,p=n.videoWidth,C=void 0===p?0:p,g=n.videoHeight,y=void 0===g?0:g,m=n.videoFPS,E=void 0===m?0:m;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e);var b="";Object.defineProperty(this,"channelUrl",{get:function(){return b},set:function(e){s(e)&&(b=e)}}),this.channelUrl=r;var O=null;Object.defineProperty(this,"localVideoElement",{get:function(){return O},set:function(e){(null==e||e instanceof Element)&&(O=e)}}),this.localVideoElement=i;var R=null;Object.defineProperty(this,"remoteVideoElement",{get:function(){return R},set:function(e){(null==e||e instanceof Element)&&(R=e)}}),this.remoteVideoElement=l;var A=!0;Object.defineProperty(this,"isVideoEnabled",{get:function(){return A},set:function(e){c(e)&&(A=e)}}),this.isVideoEnabled=f;var I=!0;Object.defineProperty(this,"isAudioEnabled",{get:function(){return I},set:function(e){c(e)&&(I=e)}}),this.isAudioEnabled=v;var S=0;Object.defineProperty(this,"videoWidth",{get:function(){return S},set:function(e){u(e)&&e>0&&(S=e)}}),this.videoWidth=C;var w=0;Object.defineProperty(this,"videoHeight",{get:function(){return w},set:function(e){u(e)&&e>0&&(w=e)}}),this.videoHeight=y;var _=0;Object.defineProperty(this,"videoFPS",{get:function(){return _},set:function(e){u(e)&&e>0&&(_=e)}}),this.videoFPS=E}var n,t,r;return n=e,(t=[{key:"getConstraints",value:function(e){var n={audio:!0,video:!e};return e||this.isVideoEnabled&&(this.videoWidth>0||this.videoHeight>0||this.videoFPS>0)&&(n.video={},this.videoWidth>0&&(n.video.width=this.videoWidth),this.videoHeight>0&&(n.video.height=this.videoHeight),this.videoFPS>0&&(n.video.frameRate={ideal:this.videoFPS})),n}}])&&de(n.prototype,t),r&&de(n,r),e}(),he={NONE:"none",CONNECTING:"connecting",OPENED:"OPENED",DROPPED:"DROPPED",CLOSED:"CLOSED"},ve={NONE:"none",END:"end",DECLINE:"decline",CANCEL:"cancel",TIMEOUT:"timeout",UNKNOWN:"unknown"},pe={CALLER:"caller",CALLEE:"callee",NONE:"none"};var Ce=function e(n){var t=n.call_id,r=n.channel_url,a=n.message_id,i=n.caller,o=n.callee,l=n.credentials,c=void 0===l?{}:l,s=n.turn_server,d=void 0===s?"":s,f=n.is_audio_call,h=void 0!==f&&f,v=n.ender,p=void 0===v?null:v,C=n.type,g=void 0===C?ve.NONE:C,y=n.period,m=void 0===y?0:y,E=n.state,b=void 0===E?he.NONE:E,O=n.role,R=void 0===O?pe.NONE:O;if(function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),t&&r&&a&&i&&o){var A=t;Object.defineProperty(this,"callId",{get:function(){return A}});var I=r;Object.defineProperty(this,"channelUrl",{get:function(){return I}});var S=a;Object.defineProperty(this,"messageId",{get:function(){return S}}),this.caller=new se(i),this.callee=new se(o);var w=h;Object.defineProperty(this,"isAudioCall",{get:function(){return w},set:function(e){w=e}});var _=rn.getSendBird().currentUser.userId;if(this._iceServers=[],c.hasOwnProperty("caller")&&c.hasOwnProperty("callee")){var k=d,N=i.user_id===_?c.caller:c.callee;this._iceServers=[{username:N.username,credential:N.password,urls:k}]}this.enderId=p?p.user_id:null,Object.defineProperty(this,"ender",{get:function(){var e=null;return this.enderId&&(e=this.caller.userId===this.enderId?this.caller:this.callee),e}});var P=ve.NONE;Object.defineProperty(this,"endType",{get:function(){return P},set:function(e){Object.values(ve).indexOf(e)>-1&&(P=e)}}),this.endType=g;var T=0;Object.defineProperty(this,"period",{get:function(){return T},set:function(e){u(e)&&(T=e)}}),this.period=m;var D=he.NONE;Object.defineProperty(this,"_state",{get:function(){return D},set:function(e){Object.values(he).indexOf(e)>-1&&(D=e)}}),this._state=b;var L=R;Object.defineProperty(this,"myRole",{get:function(){return L}})}else te.throw(M.USER_MESSAGE_REQUIRED)};function ge(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ye=new(function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.time=n,this.timeoutFn=t,this.checker=null}var n,t,r;return n=e,(t=[{key:"init",value:function(){this.stop(),this.time=0,this.timeoutFn=function(){}}},{key:"start",value:function(){var e=this;if(null===this.checker){var n=(new Date).getTime();this.checker=setInterval(function(){(new Date).getTime()-n>=e.time&&(e.stop(),f(e.timeoutFn)&&e.timeoutFn())},1e3)}}},{key:"stop",value:function(){clearInterval(this.checker),this.checker=null}}])&&ge(n.prototype,t),r&&ge(n,r),e}()),me="connect",Ee="reconnect";function be(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Oe=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,r;return n=e,r=[{key:"startTimer",value:function(n){var t=n.time,r=void 0===t?60:t,a=n.call,i=void 0===a?null:a,l=n.type,c=void 0===l?me:l;o.trace("TimerManager > startTimer({ type, call }): ",r,i),ye.time=1e3*r,i&&e.updateTimer({call:i,type:c}),ye.start()}},{key:"stopTimer",value:function(){o.trace("TimerManager > stopTimer(): ",ye),ye.stop(),ye.init()}},{key:"updateTimer",value:function(e){var n=e.call,t=void 0===n?null:n,r=e.type,a=void 0===r?me:r;if(o.trace("TimerManager > updateTimer(call): ",t),t){var i=t.callId,l=t.isAudioCall,c=t.channelUrl;ye.timeoutFn=function(){Je.sendTimeoutCall({callId:i,isAudioCall:l,channelUrl:c,type:a===me?ie.TIMEOUT:ie.RECONNECT_TIMEOUT})}}}}],(t=null)&&be(n.prototype,t),r&&be(n,r),e}();function Re(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ae=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,r;return n=e,r=[{key:"init",value:function(){e.peerConnectionClient&&e.peerConnectionClient.close(),e.peerConnectionClient=null}},{key:"setPeerConnectionClient",value:function(n){e.peerConnectionClient=n}},{key:"getPeerConnectionClient",value:function(){return e.peerConnectionClient}}],(t=null)&&Re(n.prototype,t),r&&Re(n,r),e}();function Ie(e,n,t,r,a,i,o){try{var l=e[i](o),c=l.value}catch(e){return void t(e)}l.done?n(c):Promise.resolve(c).then(r,a)}function Se(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Ae.peerConnectionClient=null;var we="relay",_e="connected",ke="connected",Ne="disconnected",Pe="closed",Te=function(e){var n={iceServers:e._iceServers,iceTransportPolicy:we};return new RTCPeerConnection(n)},De=function(){function e(n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),o.trace("PeerConnectionClient > constructor(call): ",n),Ae.init(),this.init(),this.peerConnection=Te(n),this.definePeerConnectionEvent(),this.callId=n.callId}var n,t,r;return n=e,(t=[{key:"init",value:function(){this.callId=null,this.remoteStream=null,this.localStream=null,this.peerConnection=null}},{key:"close",value:function(){this.peerConnection&&this.peerConnection.close(),this.init()}},{key:"processConnectionChanged",value:function(){if(this.peerConnection){var e=this.peerConnection,n=e.iceConnectionState,t=e.connectionState,r=He.getCall(this.callId);if(n===ke&&t===_e)Oe.stopTimer(),this.callId&&(r._state===he.CONNECTING?(r._state=he.OPENED,nn.runOnOpened(r)):r._state===he.DROPPED&&(r._state=he.OPENED,nn.runOnReopened(r)));else if(n===Ne){Oe.startTimer({time:60,call:He.getCall(this.callId),type:Ee}),r._state=he.DROPPED,nn.runOnDropped(r)}else n===Pe&&(Oe.stopTimer(),this.init())}}},{key:"definePeerConnectionEvent",value:function(){var e=this;this.peerConnection.onicecandidate=function(n){o.trace("PeerConnectionClient > onicecandidate(event): ",n);var t=n.candidate;t&&t.candidate.indexOf("typ relay ")>-1&&Je.sendCandidate({callId:e.callId,candidate:t}).then(function(e){return o.trace("PeerConnectionClient > onicecandidate() > sendCandidate(): ",e)}).catch(function(e){return o.trace("[ERROR] PeerConnectionClient > onicecandidate() > sendCandidate(): ",e)})},this.peerConnection.ontrack=function(n){o.trace("PeerConnectionClient > ontrack(event): ",n),e.updateRemoteStream(n.streams[0])},this.peerConnection.oniceconnectionstatechange=function(n){o.trace("PeerConnectionClient > oniceconnectionstatechange(event): ",n,e.peerConnection),e.processConnectionChanged()},this.peerConnection.onconnectionstatechange=function(n){o.trace("PeerConnectionClient > onconnectionstatechange(event): ",n,e.peerConnection),e.processConnectionChanged()}}},{key:"updateRemoteStream",value:function(e){var n=this;if(o.trace("PeerConnectionClient > updateRemoteStream(stream): ",e),this.peerConnection&&e){try{e.getTracks().forEach(function(t){return n.peerConnection.addTrack(t,e)})}catch(e){o.trace("[ERROR] PeerConnectionClient > updateRemoteStream(stream) - addTrack: ",e)}this.remoteStream=e,rn.remoteVideoElement&&(rn.remoteVideoElement.srcObject=e)}}},{key:"updateLocalStream",value:function(e){var n=this;o.trace("PeerConnectionClient > updateLocalStream(stream): ",e),rn.localVideoElement.srcObject=null,this.peerConnection&&e&&e.getTracks().forEach(function(t){try{n.peerConnection.addTrack(t,e)}catch(t){o.trace("[ERROR] PeerConnectionClient > updateLocalStream(stream): ",e,n.peerConnection)}}),this.localStream=e,rn.localVideoElement&&(rn.localVideoElement.srcObject=e)}},{key:"enableLocalVideo",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];o.trace("PeerConnectionClient > enableLocalVideo(isEnabled): ",e);var n=this.localStream.getVideoTracks();if(n&&n.length>0){var t=He.getCall(this.callId);(t.myRole===pe.CALLER?t.caller:t.callee).isVideoEnabled=e,this.localStream.getVideoTracks()[0].enabled=e,Je.sendVideoCall({callId:this.callId,isEnabled:e})}}},{key:"enableLocalAudio",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];o.trace("PeerConnectionClient > enableLocalAudio(isEnabled): ",e);var n=this.localStream.getAudioTracks();if(n&&n.length>0){var t=He.getCall(this.callId);(t.myRole===pe.CALLER?t.caller:t.callee).isAudioEnabled=e,this.localStream.getAudioTracks()[0].enabled=e,Je.sendAudioCall({callId:this.callId,isEnabled:e})}}},{key:"setMediaDevice",value:function(){var e,n=(e=regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,o.trace("PeerConnectionClient > setMediaDevice(deviceId): ",n),!rn.localVideoElement||d(rn.localVideoElement.sinkId)){e.next=7;break}return e.next=5,rn.localVideoElement.setSinkId(n);case 5:e.next=8;break;case 7:te.throw(M.INVALID_LOCAL_VIDEO_ELEMENT);case 8:e.next=14;break;case 10:throw e.prev=10,e.t0=e.catch(0),o.trace("[ERROR] PeerConnectionClient > setMediaDevice(): ",e.t0),e.t0;case 14:case"end":return e.stop()}},e,null,[[0,10]])}),function(){var n=this,t=arguments;return new Promise(function(r,a){var i=e.apply(n,t);function o(e){Ie(i,r,a,o,l,"next",e)}function l(e){Ie(i,r,a,o,l,"throw",e)}o(void 0)})});return function(e){return n.apply(this,arguments)}}()}])&&Se(n.prototype,t),r&&Se(n,r),e}();function Le(e){return(Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ve(e,n,t,r,a,i,o){try{var l=e[i](o),c=l.value}catch(e){return void t(e)}l.done?n(c):Promise.resolve(c).then(r,a)}function xe(e){return function(){var n=this,t=arguments;return new Promise(function(r,a){var i=e.apply(n,t);function o(e){Ve(i,r,a,o,l,"next",e)}function l(e){Ve(i,r,a,o,l,"throw",e)}o(void 0)})}}function Me(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ue(e,n){return!n||"object"!==Le(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function Be(e){return(Be=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function je(e,n){return(je=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}var Fe=function(e){function n(e){var t=e.payload;return function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),Ue(this,Be(n).call(this,t))}var t,r,a;return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&je(e,n)}(n,Ce),t=n,(r=[{key:"accept",value:function(){var e=xe(regeneratorRuntime.mark(function e(n,t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o.info("Call > accept(callOptions): ",n),Je.isConnectedToSendBird()||te.throw(M.SENDBIRD_CONNECTION_REQUIRED),(null===n||d(n))&&te.throw(M.INVALID_PARAMETER,H),n instanceof fe||te.throw(M.INVALID_PARAMETER,W),s(n.channelUrl)||te.throw(M.INVALID_PARAMETER,Q),rn.getActiveCall()&&te.throw(M.INVALID_ACTION,U),this.myRole!==pe.CALLEE&&te.throw(M.INVALID_ACTION,B),rn.remoteVideoElement=n.remoteVideoElement,rn.localVideoElement=n.localVideoElement,e.next=12,Je.sendOfferCall({call:this,callOptions:n});case 12:return r=e.sent,e.abrupt("return",h(t,null,r));case 16:return e.prev=16,e.t0=e.catch(0),o.error("Call > accept(): ",e.t0),e.abrupt("return",h(t,e.t0));case 20:case"end":return e.stop()}},e,this,[[0,16]])}));return function(n,t){return e.apply(this,arguments)}}()},{key:"end",value:function(){var e=xe(regeneratorRuntime.mark(function e(n){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o.info("Call > end()"),e.next=4,Je.sendEndCall({call:this});case 4:return t=e.sent,e.abrupt("return",h(n,null,t));case 8:return e.prev=8,e.t0=e.catch(0),o.error("Call > end(): ",e.t0),e.abrupt("return",h(n,e.t0));case 12:case"end":return e.stop()}},e,this,[[0,8]])}));return function(n){return e.apply(this,arguments)}}()},{key:"startVideo",value:function(){try{var e=rn.getActiveCall(),n=Ae.getPeerConnectionClient();e&&e.callId===this.callId&&!this.isAudioCall&&n&&this.callId===n.callId||te.throw(M.INVALID_ACTION),n.enableLocalVideo(!0)}catch(e){o.error("Call > startVideo(): ",e)}}},{key:"stopVideo",value:function(){try{var e=rn.getActiveCall(),n=Ae.getPeerConnectionClient();e&&e.callId===this.callId&&!this.isAudioCall&&n&&this.callId===n.callId||te.throw(M.INVALID_ACTION),n.enableLocalVideo(!1)}catch(e){o.error("Call > stopVideo(): ",e)}}},{key:"muteMicrophone",value:function(){try{var e=rn.getActiveCall(),n=Ae.getPeerConnectionClient();e&&e.callId===this.callId&&n&&this.callId===n.callId||te.throw(M.INVALID_ACTION),n.enableLocalAudio(!1)}catch(e){o.error("Call > muteMicrophone(): ",e)}}},{key:"unmuteMicrophone",value:function(){try{var e=rn.getActiveCall(),n=Ae.getPeerConnectionClient();e&&e.callId===this.callId&&n&&this.callId===n.callId||te.throw(M.INVALID_ACTION),n.enableLocalAudio(!0)}catch(e){o.error("Call > unmuteMicrophone(): ",e)}}},{key:"setMediaDevice",value:function(){var e=xe(regeneratorRuntime.mark(function e(n,t){var r,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=rn.getActiveCall(),a=Ae.getPeerConnectionClient(),s(n)||te.throw(M.INVALID_DEVICE_ID),r&&r.callId===this.callId&&a&&this.callId===a.callId||te.throw(M.UNSUITABLE_CALL),e.next=7,a.setMediaDevice(n);case 7:return e.abrupt("return",h(t,null));case 10:return e.prev=10,e.t0=e.catch(0),o.error("Call > setMediaDevice(): ",e.t0),e.abrupt("return",h(t,e.t0));case 14:case"end":return e.stop()}},e,this,[[0,10]])}));return function(n,t){return e.apply(this,arguments)}}()}])&&Me(t.prototype,r),a&&Me(t,a),n}();function Ge(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var He=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,r;return n=e,r=[{key:"init",value:function(){e.calls={}}},{key:"addCall",value:function(n){e.calls[n.callId]=n}},{key:"getCall",value:function(n){return e.calls[n]}},{key:"removeCall",value:function(n){delete e.calls[n]}},{key:"updateMediaEnabledFromConstraints",value:function(e){var n=e.call,t=e.isAudioEnabled,r=e.isVideoEnabled,a=e.targetRole;if(o.trace("CallManager > updateMediaEnabledFromConstraints({ call, isAudioEnabled, isVideoEnabled, targetRole }): ",n,t,r,a),n){var i=n[a];i&&(i.isAudioEnabled=t,i.isVideoEnabled=!!r)}return n}},{key:"updateSignalCall",value:function(n){o.trace("CallManager > updateSignalCall(payload): ",n);var t=n.type,r=n.is_enabled,a=e.calls[n.call_id];return a&&(t===oe.OFFER||t===oe.ANSWER?a._state=he.CONNECTING:t===oe.AUDIO?a.myRole===pe.CALLER?a.callee.isAudioEnabled=r:a.myRole===pe.CALLEE&&(a.caller.isAudioEnabled=r):t===oe.VIDEO&&(a.myRole===pe.CALLER?a.callee.isVideoEnabled=r:a.myRole===pe.CALLEE&&(a.caller.isVideoEnabled=r))),a}},{key:"updateEndCall",value:function(n){o.trace("CallManager > updateEndCall(payload): ",n);var t=e.calls[n.call_id];if(t){t.caller=new se(n.caller),t.callee=new se(n.callee),t.isAudioCall=n.is_audio_call;var r=n.ender;if(r){t.enderId=r.user_id;var a=t.myRole===pe.CALLER?t.caller:t.callee;a.nickname=r.nickname,a.profileUrl=r.profile_url}t.endType=n.type,t.period=n.period,t._state=he.CLOSED}return t}},{key:"updateCallerCalleeInfo",value:function(n){var t=n.callId,r=n.sender;o.trace("CallManager > updateCallerCalleeInfo({ callId, sender }): ",t,r);try{var a=e.calls[t];return a&&(a.caller.userId===r.userId?(a.caller.nickname=r.nickname,a.caller.profileUrl=r.profileUrl):a.callee.userId===r.userId?(a.callee.nickname=r.nickname,a.callee.profileUrl=r.profileUrl):o.trace("CallManager > updateCallerCalleeInfo() - caller and callee are not matched with sender")),a}catch(e){o.trace("[ERROR] CallManager > updateCallerCalleeInfo(): ",e)}}}],(t=null)&&Ge(n.prototype,t),r&&Ge(n,r),e}();function We(e,n,t,r,a,i,o){try{var l=e[i](o),c=l.value}catch(e){return void t(e)}l.done?n(c):Promise.resolve(c).then(r,a)}function Qe(e){return function(){var n=this,t=arguments;return new Promise(function(r,a){var i=e.apply(n,t);function o(e){We(i,r,a,o,l,"next",e)}function l(e){We(i,r,a,o,l,"throw",e)}o(void 0)})}}function Xe(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}He.calls={};var Je=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,r;return n=e,t=null,r=[{key:"isConnectedToSendBird",value:function(){try{var e=rn.getSendBird();return e.currentUser&&e.currentUser.userId&&"CLOSED"!==e.getConnectionState()}catch(e){return o.trace("[ERROR] Signaling > isConnectedToSendBird(): ",e),!1}}},{key:"send",value:function(n){var t=n.channel,r=n.messageData,a=n.callId,i=void 0===a?null:a;return new Promise(function(n,a){try{e.isConnectedToSendBird()||te.throw(M.SENDBIRD_CONNECTION_REQUIRED);var l=rn.getSendBird(),c=new l.UserMessageParams;c.message=ce,c.customType=i?"".concat(ue,"_").concat(i):ue,c.data=r,t.sendUserMessage(c,function(e,t){if(l.getErrorFirstCallback()){var r=e;e=t,t=r}t?(o.trace("[ERROR] Signaling > send() - sendBird.getChannel(): ",t,c),a(te.create(t))):(o.trace("Signaling > send(): ",e),n(e))})}catch(e){o.trace("[ERROR] Signaling > send(): ",e),a(te.create(M.UNKNOWN))}})}},{key:"getSendBirdGroupChannel",value:function(e){return new Promise(function(n,t){try{var r=rn.getSendBird();r.GroupChannel.getChannel(e,function(e,a){if(r.getErrorFirstCallback()){var i=e;e=a,a=i}a?(o.trace("[ERROR] Signaling > getSendBirdGroupChannel() - sendBird.getChannel(): ",a),t(te.create(a))):(o.trace("Signaling > getSendBirdGroupChannel(): ",e),2!==e.members.length||e.isPublic||e.isSuper?t(te.create(M.UNSUITABLE_CHANNEL)):n(e))})}catch(e){o.trace("[ERROR] Signaling > getSendBirdGroupChannel(): ",e),t(te.create(M.UNKNOWN))}})}},{key:"sendStartCall",value:function(){var n=Qe(regeneratorRuntime.mark(function n(t){var r,a,i,l,c,u,s,d,f,h,v,p,C;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.isAudioCall,a=t.callOptions,n.prev=1,o.trace("Signaling > sendStartCall({ isAudioCall, callOptions }): ",r,a),i=a.channelUrl,n.next=6,e.getSendBirdGroupChannel(i);case 6:return l=n.sent,Oe.startTimer({time:rn.getStartCallTimeout()}),c=a.isAudioEnabled,u=a.isVideoEnabled,s=e.buildStart({isAudioCall:r,isAudioEnabled:c,isVideoEnabled:u}),n.next=12,e.send({channel:l,messageData:s});case 12:return d=n.sent,(f=e.getPayloadFromUserMessage(d)).state=he.CONNECTING,f.role=pe.CALLER,h=new Fe({payload:f}),rn.setActiveCall(h),Oe.updateTimer({call:h}),v=new De(h),p=a.getConstraints(r),n.next=23,g(p);case 23:return C=n.sent,v.updateLocalStream(C),!r&&u||v.enableLocalVideo(!1),c||v.enableLocalAudio(!1),Ae.setPeerConnectionClient(v),He.updateMediaEnabledFromConstraints({call:h,isAudioEnabled:c,isVideoEnabled:u,targetRole:pe.CALLER}),nn.runOnStartSent(h,d),n.abrupt("return",h);case 33:throw n.prev=33,n.t0=n.catch(1),o.trace("[ERROR] Signaling > sendStartCall(): ",n.t0),Oe.stopTimer(),rn.removeActiveCall(),n.t0;case 39:case"end":return n.stop()}},n,null,[[1,33]])}));return function(e){return n.apply(this,arguments)}}()},{key:"sendCandidate",value:function(){var n=Qe(regeneratorRuntime.mark(function n(t){var r,a,i,l,c;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=t.callId,a=t.candidate,n.prev=1,o.trace("Signaling > sendCandidate({ callId, candidate }): ",r,a),!(i=He.getCall(r))){n.next=12;break}return n.next=7,e.getSendBirdGroupChannel(i.channelUrl);case 7:return l=n.sent,c=e.buildCandidate({callId:r,candidate:a}),n.next=11,e.send({channel:l,messageData:c,callId:r});case 11:return n.abrupt("return",n.sent);case 12:n.next=18;break;case 14:throw n.prev=14,n.t0=n.catch(1),o.trace("[ERROR] Signaling > sendCandidate(): ",n.t0),n.t0;case 18:case"end":return n.stop()}},n,null,[[1,14]])}));return function(e){return n.apply(this,arguments)}}()},{key:"sendOfferCall",value:function(){var n=Qe(regeneratorRuntime.mark(function n(t){var r,a,i,l,c,u,s,d,f,h,v,p,C,y,m,E,b;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.call,a=t.callOptions,n.prev=1,o.trace("Signaling > sendOfferCall({ call, callOptions }): ",r,a),rn.setActiveCall(r),i=r.callId,l=r.isAudioCall,c=a.channelUrl,n.next=8,e.getSendBirdGroupChannel(c);case 8:return u=n.sent,s=new De(r),d=a.getConstraints(l),n.next=13,g(d);case 13:return f=n.sent,s.updateLocalStream(f),!l&&a.isVideoEnabled||s.enableLocalVideo(!1),a.isAudioEnabled||s.enableLocalAudio(!1),Ae.setPeerConnectionClient(s),h=s.peerConnection,n.prev=19,n.t0=h,n.next=23,h.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!l});case 23:return n.t1=n.sent,n.next=26,n.t0.setLocalDescription.call(n.t0,n.t1);case 26:n.next=32;break;case 28:n.prev=28,n.t2=n.catch(19),o.trace("[ERROR] Signaling > sendOfferCall() > createOffer(): ",n.t2),te.throw(M.ACCEPTING_FAIL);case 32:return Oe.startTimer({call:r}),v=a.isAudioEnabled,p=a.isVideoEnabled,C=h.localDescription,y=e.buildOffer({callId:i,isAudioEnabled:v,isVideoEnabled:p,localDescription:C}),n.next=38,e.send({channel:u,messageData:y,callId:i});case 38:return m=n.sent,E=e.getPayloadFromUserMessage(m),b=He.updateSignalCall(E),rn.setActiveCall(b),He.updateMediaEnabledFromConstraints({call:r,isAudioEnabled:v,isVideoEnabled:p,targetRole:pe.CALLEE}),nn.runOnAcceptSent(b),n.abrupt("return",b);case 47:throw n.prev=47,n.t3=n.catch(1),o.trace("[ERROR] Signaling > sendOfferCall(): ",n.t3),Oe.stopTimer(),rn.removeActiveCall(r.callId),n.t3;case 53:case"end":return n.stop()}},n,null,[[1,47],[19,28]])}));return function(e){return n.apply(this,arguments)}}()},{key:"sendAnswerCall",value:function(){var n=Qe(regeneratorRuntime.mark(function n(t){var r,a,i,l,c,u,s,d,f,h;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.call,a=t.channel,n.prev=1,o.trace("Signaling > sendAnswerCall({ call, channel }): ",r,a),i=r.callId,l=r.isAudioCall,c=Ae.getPeerConnectionClient().peerConnection,n.t0=c,n.next=8,c.createAnswer({offerToReceiveAudio:!0,offerToReceiveVideo:!l});case 8:return n.t1=n.sent,n.next=11,n.t0.setLocalDescription.call(n.t0,n.t1);case 11:return u=c.localDescription,s=e.buildAnswer({callId:i,localDescription:u}),n.next=15,e.send({channel:a,messageData:s,callId:i});case 15:return d=n.sent,f=e.getPayloadFromUserMessage(d),n.abrupt("return",He.updateSignalCall(f));case 20:throw n.prev=20,n.t2=n.catch(1),o.trace("[ERROR] Signaling > sendAnswerCall(): ",n.t2),h=He.getCall(h.callId),e.sendUnknownCall(h),n.t2;case 26:case"end":return n.stop()}},n,null,[[1,20]])}));return function(e){return n.apply(this,arguments)}}()},{key:"sendEndCall",value:function(){var n=Qe(regeneratorRuntime.mark(function n(t){var r,a,i,l,c,u,s,d,f,h,v,p,C;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.call,n.prev=1,o.trace("Signaling > sendEndCall({ call }): ",r),Oe.stopTimer(),a=r.channelUrl,i=r._state,l=r.callId,c=r.isAudioCall,n.next=7,e.getSendBirdGroupChannel(a);case 7:return u=n.sent,s=ie.END,i===he.CONNECTING?r.myRole===pe.CALLER?s=ie.CANCEL:r.myRole===pe.CALLEE?s=ie.DECLINE:te.throw(M.INVALID_ACTION,G):i===he.CLOSED&&te.throw(M.INVALID_ACTION,F),d=e.buildEnd({type:s,callId:l,isAudioCall:c}),n.next=13,e.send({channel:u,messageData:d,callId:l});case 13:return f=n.sent,h=e.getPayloadFromUserMessage(f),v=He.updateEndCall(h),(p=rn.getActiveCall())&&p.callId===l&&rn.removeActiveCall(l),nn.runOnEndSent(v,f),n.abrupt("return",v);case 22:throw n.prev=22,n.t0=n.catch(1),o.trace("Signaling > sendEndCall(): ",n.t0),C=He.getCall(C.callId),e.sendUnknownCall(C),n.t0;case 28:case"end":return n.stop()}},n,null,[[1,22]])}));return function(e){return n.apply(this,arguments)}}()},{key:"sendTimeoutCall",value:function(){var n=Qe(regeneratorRuntime.mark(function n(t){var r,a,i,l,c,u,s,d,f,h,v;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.callId,a=t.isAudioCall,i=t.channelUrl,l=t.type,c=void 0===l?ie.TIMEOUT:l,n.prev=1,o.trace("Signaling > sendTimeoutCall({ callId, isAudioCall, channelUrl }): ",r,a,i),Oe.stopTimer(),n.next=6,e.getSendBirdGroupChannel(i);case 6:return u=n.sent,s=e.buildEnd({type:c,callId:r,isAudioCall:a}),n.next=10,e.send({channel:u,messageData:s,callId:r});case 10:return d=n.sent,f=e.getPayloadFromUserMessage(d),h=He.updateEndCall(f),rn.removeActiveCall(r),nn.runOnEndSent(h,d),n.abrupt("return",{});case 18:return n.prev=18,n.t0=n.catch(1),o.trace("[ERROR] Signaling > sendTimeoutCall(): ",n.t0),v=He.getCall(r),nn.runOnEndSent(v,null),n.abrupt("return",{});case 24:case"end":return n.stop()}},n,null,[[1,18]])}));return function(e){return n.apply(this,arguments)}}()},{key:"sendUnknownCall",value:function(){var n=Qe(regeneratorRuntime.mark(function n(t){var r,a,i,l,c,u,s,d,f,h;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.callId,a=t.isAudioCall,i=t.channelUrl,n.prev=1,o.trace("Signaling > sendUnknownCall({ callId, isAudioCall, channelUrl }): ",r,a,i),Oe.stopTimer(),n.next=6,e.getSendBirdGroupChannel(i);case 6:return l=n.sent,c=ie.UNKNOWN,u=e.buildEnd({type:c,callId:r,isAudioCall:a}),n.next=11,e.send({channel:l,messageData:u,callId:r});case 11:return s=n.sent,d=e.getPayloadFromUserMessage(s),f=He.updateEndCall(d),rn.removeActiveCall(r),nn.runOnEndSent(f,s),n.abrupt("return",{});case 19:return n.prev=19,n.t0=n.catch(1),o.trace("[ERROR] Signaling > sendUnknownCall(): ",n.t0),h=He.getCall(r),nn.runOnEndSent(h,null),n.abrupt("return",{});case 25:case"end":return n.stop()}},n,null,[[1,19]])}));return function(e){return n.apply(this,arguments)}}()},{key:"sendVideoCall",value:function(){var n=Qe(regeneratorRuntime.mark(function n(t){var r,a,i,l,c,u,s,d;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.callId,a=t.isEnabled,n.prev=1,o.trace("Signaling > sendVideoCall({ callId, isEnabled }): ",r,a),i=He.getCall(r),n.next=6,e.getSendBirdGroupChannel(i.channelUrl);case 6:return l=n.sent,c=e.buildVideo({callId:r,isEnabled:a}),n.next=10,e.send({channel:l,messageData:c,callId:r});case 10:return u=n.sent,s=e.getPayloadFromUserMessage(u),d=He.updateSignalCall(s),n.abrupt("return",d);case 16:n.prev=16,n.t0=n.catch(1),o.trace("[ERROR] Signaling > sendVideoCall(): ",n.t0);case 19:case"end":return n.stop()}},n,null,[[1,16]])}));return function(e){return n.apply(this,arguments)}}()},{key:"sendAudioCall",value:function(){var n=Qe(regeneratorRuntime.mark(function n(t){var r,a,i,l,c,u,s,d;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.callId,a=t.isEnabled,n.prev=1,o.trace("Signaling > sendVideoCall({ callId, isEnabled }): ",r,a),i=He.getCall(r),n.next=6,e.getSendBirdGroupChannel(i.channelUrl);case 6:return l=n.sent,c=e.buildAudio({callId:r,isEnabled:a}),n.next=10,e.send({channel:l,messageData:c,callId:r});case 10:return u=n.sent,s=e.getPayloadFromUserMessage(u),d=He.updateSignalCall(s),n.abrupt("return",d);case 16:n.prev=16,n.t0=n.catch(1),o.trace("[ERROR] Signaling > sendAudioCall(): ",n.t0);case 19:case"end":return n.stop()}},n,null,[[1,16]])}));return function(e){return n.apply(this,arguments)}}()},{key:"isVideoChatMessage",value:function(e){try{return e&&e.isUserMessage()&&e.customType.indexOf(ue)>-1&&e.data&&Object.values(le).indexOf(e.data.substring(0,4))>-1}catch(e){return o.trace("[ERROR] Signaling > isVideoChatMessage(): ",e),!1}}},{key:"getPayloadFromUserMessage",value:function(n){var t=null;if(e.isVideoChatMessage(n)){var r=n.data.substring(0,4),a=JSON.parse(n.data.substring(4));t=v({},{cmd:r},a,{message_id:n.messageId,channel_url:n.channelUrl})}return o.trace("Signaling > getPayloadFromUserMessage(message): ",n,t),t}},{key:"addDefaultPayload",value:function(e){return e.videochat_protocol_ver=1,e}},{key:"buildStart",value:function(n){var t=n.isAudioCall,r=n.isAudioEnabled,a=n.isVideoEnabled,i={type:ae.START,constraints:{audio:r,video:a},is_audio_call:t};return i=e.addDefaultPayload(i),o.trace("Signaling > buildStart(): ",i),le.STCA+JSON.stringify(i)}},{key:"buildEnd",value:function(n){var t={type:n.type,call_id:n.callId,is_audio_call:n.isAudioCall};return t=e.addDefaultPayload(t),o.trace("Signaling > buildEnd(): ",t),le.ENCA+JSON.stringify(t)}},{key:"buildOffer",value:function(n){var t=n.callId,r=n.isAudioEnabled,a=n.isVideoEnabled,i=n.localDescription;try{var l={type:oe.OFFER,sdp:V(i.sdp),call_id:t,constraints:{audio:r,video:a}};return l=e.addDefaultPayload(l),o.trace("Signaling > buildOffer(): ",l),le.SGNL+JSON.stringify(l)}catch(e){throw o.trace("[ERROR] Signaling > buildOffer(): ",e),e}}},{key:"buildAnswer",value:function(n){var t=n.callId,r=n.localDescription;try{var a={type:oe.ANSWER,sdp:V(r.sdp),call_id:t};return a=e.addDefaultPayload(a),o.trace("Signaling > buildAnswer(): ",a),le.SGNL+JSON.stringify(a)}catch(e){throw o.trace("[ERROR] Signaling > buildAnswer(): ",e),e}}},{key:"buildCandidate",value:function(n){var t=n.callId,r=n.candidate,a={type:oe.CANDIDATE,sdp:r.candidate,sdp_mline_index:r.sdpMLineIndex,sdp_mid:r.sdpMid,call_id:t};return a=e.addDefaultPayload(a),o.trace("Signaling > buildVideo(): ",a),le.SGNL+JSON.stringify(a)}},{key:"buildVideo",value:function(n){var t=n.callId,r=n.isEnabled,a={type:oe.VIDEO,call_id:t,is_enabled:r};return a=e.addDefaultPayload(a),o.trace("Signaling > buildVideo(): ",a),le.SGNL+JSON.stringify(a)}},{key:"buildAudio",value:function(n){var t=n.callId,r=n.isEnabled,a={type:oe.AUDIO,call_id:t,is_enabled:r};return a=e.addDefaultPayload(a),o.trace("Signaling > buildAudio(): ",a),le.SGNL+JSON.stringify(a)}}],t&&Xe(n.prototype,t),r&&Xe(n,r),e}();function Ke(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function qe(e,n,t,r,a,i,o){try{var l=e[i](o),c=l.value}catch(e){return void t(e)}l.done?n(c):Promise.resolve(c).then(r,a)}function ze(e){return function(){var n=this,t=arguments;return new Promise(function(r,a){var i=e.apply(n,t);function o(e){qe(i,r,a,o,l,"next",e)}function l(e){qe(i,r,a,o,l,"throw",e)}o(void 0)})}}var Ze=function(){var e=ze(regeneratorRuntime.mark(function e(n,t){var r,a,i,l,c,u,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,o.trace("MessageParser > processOffer(payload, channel): ",n,t),Oe.stopTimer(),r=He.updateSignalCall(n),a=n.constraints,i=a.audio,l=a.video,c=pe.CALLEE,He.updateMediaEnabledFromConstraints({call:r,isAudioEnabled:i,isVideoEnabled:l,targetRole:c}),r.myRole!==pe.CALLER){e.next=16;break}return u=Ae.getPeerConnectionClient().peerConnection,s={type:n.type,sdp:x(n.sdp)},e.next=14,u.setRemoteDescription(s);case 14:return e.next=16,Je.sendAnswerCall({call:r,channel:t});case 16:nn.runOnAcceptReceived(He.getCall(r.callId)),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(0),o.trace("[ERROR] MessageParser > processOffer(): ",e.t0),Je.sendUnknownCall({callId:n.call_id,isAudioCall:n.is_audio_call,channelUrl:n.channel_url});case 23:case"end":return e.stop()}},e,null,[[0,19]])}));return function(n,t){return e.apply(this,arguments)}}(),Ye=function(){var e=ze(regeneratorRuntime.mark(function e(n){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,o.trace("MessageParser > processAnswer(payload): ",n),Oe.stopTimer(),He.updateSignalCall(n).myRole!==pe.CALLEE){e.next=9;break}return t=Ae.getPeerConnectionClient().peerConnection,r={type:n.type,sdp:x(n.sdp)},e.next=9,t.setRemoteDescription(r);case 9:e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),o.trace("[ERROR] MessageParser > processAnswer(): ",e.t0),Je.sendUnknownCall({callId:n.call_id,isAudioCall:n.is_audio_call,channelUrl:n.channel_url});case 15:case"end":return e.stop()}},e,null,[[0,11]])}));return function(n){return e.apply(this,arguments)}}(),$e=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,r;return n=e,r=[{key:"init",value:function(){e.handlers={}}},{key:"addSendBirdChannelHandler",value:function(n){o.trace("MessageParser > addSendBirdChannelHandler(identifier): ",n);var t=rn.getSendBird(),r=new t.ChannelHandler;r.onMessageReceived=function(e,n){if(o.trace("MessageParser > onMessageReceived(channel, message): ",e,n),Je.isVideoChatMessage(n)){var t=Je.getPayloadFromUserMessage(n),r=He.getCall(t.call_id);r&&r.channelUrl===e.url&&He.updateCallerCalleeInfo({callId:t.call_id,sender:n.sender});var a=rn.getActiveCall(),i=!!a&&a.channelUrl===e.url;switch(t.cmd){case le.STCA:!function(e){try{o.trace("MessageParser > processStart(payload): ",e),e.state=he.CONNECTING;var n=rn.getSendBird(),t=e.callee;e.role=n.currentUser.userId===t.user_id?pe.CALLEE:pe.CALLER;var r=new Fe({payload:e});He.addCall(r);var a=e.constraints,i=a.audio,l=a.video,c=pe.CALLER;He.updateMediaEnabledFromConstraints({call:r,isAudioEnabled:i,isVideoEnabled:l,targetRole:c}),nn.runOnStartReceived(r)}catch(e){o.trace("[ERROR] MessageParser > processStart(): ",e)}}(t);break;case le.ENCA:!function(e,n){try{o.trace("MessageParser > processEnd(payload, isActiveCallChannel): ",e,n);var t=He.updateEndCall(e);n&&(Oe.stopTimer(),rn.removeActiveCall(t.callId)),nn.runOnEndReceived(t)}catch(e){o.trace("[ERROR] MessageParser > processEnd(): ",e)}}(t,i);break;case le.SGNL:var l=t.type;l===oe.OFFER?Ze(t,e):l===oe.ANSWER&&i?Ye(t):l===oe.CANDIDATE&&i?function(e){try{o.trace("MessageParser > processCandidate(payload): ",e);var n=Ae.getPeerConnectionClient();if(n&&n.callId===e.call_id){var t={candidate:e.sdp,sdpMLineIndex:e.sdp_mline_index,sdpMid:e.sdp_mid};n.peerConnection.addIceCandidate(t).then(function(){return o.trace("MessageParser > processCandidate() > addIceCandidate()")}).catch(function(e){return o.trace("[ERROR] MessageParser > processCandidate() > addIceCandidate(): ",e)})}}catch(e){o.trace("MessageParser > processCandidate(): ",e)}}(t):l===oe.AUDIO&&i?function(e){o.trace("MessageParser > processAudio(payload): ",e);var n=He.updateSignalCall(e);nn.runOnOpponentAudioStateChanged(n)}(t):l===oe.VIDEO&&i?function(e){o.trace("MessageParser > processVideo(payload): ",e);var n=He.updateSignalCall(e);nn.runOnOpponentVideoStateChanged(n)}(t):o.trace("onMessageReceived(): SGNL.type is not valid: ",l);break;default:o.trace("MessageParser > onMessageReceived() - payload(CMD is not valid): ",t)}}},t.addChannelHandler(n,r),e.handlers[n]=r}},{key:"removeSendBirdChannelHandler",value:function(n){o.trace("MessageParser > removeSendBirdChannelHandler(identifiers): ",n);var t=rn.getSendBird();n.forEach(function(n){delete e.handlers[n],t.removeChannelHandler(n)})}}],(t=null)&&Ke(n.prototype,t),r&&Ke(n,r),e}();function en(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}$e.handlers={};var nn=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,r;return n=e,r=[{key:"init",value:function(){e.handlers={},$e.removeSendBirdChannelHandler(["SENDBIRD_HANDLER_IDENTIFIER_VIDEOCHAT"])}},{key:"add",value:function(n,t){e.handlers[n]=t,$e.addSendBirdChannelHandler("SENDBIRD_HANDLER_IDENTIFIER_VIDEOCHAT")}},{key:"remove",value:function(n){delete e.handlers[n]}},{key:"runOnStartSent",value:function(n,t){for(var r in e.handlers)e.handlers.hasOwnProperty(r)&&e.handlers[r].onStartSent(n,t)}},{key:"runOnStartReceived",value:function(n){for(var t in e.handlers)e.handlers.hasOwnProperty(t)&&e.handlers[t].onStartReceived(n)}},{key:"runOnAcceptSent",value:function(n){for(var t in e.handlers)e.handlers.hasOwnProperty(t)&&e.handlers[t].onAcceptSent(n)}},{key:"runOnAcceptReceived",value:function(n){for(var t in e.handlers)e.handlers.hasOwnProperty(t)&&e.handlers[t].onAcceptReceived(n)}},{key:"runOnEndSent",value:function(n,t){for(var r in e.handlers)e.handlers.hasOwnProperty(r)&&e.handlers[r].onEndSent(n,t)}},{key:"runOnEndReceived",value:function(n){for(var t in e.handlers)e.handlers.hasOwnProperty(t)&&e.handlers[t].onEndReceived(n)}},{key:"runOnOpened",value:function(n){for(var t in e.handlers)e.handlers.hasOwnProperty(t)&&e.handlers[t].onOpened(n)}},{key:"runOnDropped",value:function(n){for(var t in e.handlers)e.handlers.hasOwnProperty(t)&&e.handlers[t].onDropped(n)}},{key:"runOnReopened",value:function(n){for(var t in e.handlers)e.handlers.hasOwnProperty(t)&&e.handlers[t].onReopened(n)}},{key:"runOnOpponentAudioStateChanged",value:function(n){for(var t in e.handlers)e.handlers.hasOwnProperty(t)&&e.handlers[t].onOpponentAudioStateChanged(n)}},{key:"runOnOpponentVideoStateChanged",value:function(n){for(var t in e.handlers)e.handlers.hasOwnProperty(t)&&e.handlers[t].onOpponentVideoStateChanged(n)}}],(t=null)&&en(n.prototype,t),r&&en(n,r),e}();function tn(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}nn.handlers={};var rn=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,r;return n=e,r=[{key:"setActiveCall",value:function(n){e.activeCallId=n.callId,He.addCall(n)}},{key:"getActiveCall",value:function(){return He.getCall(e.activeCallId)}},{key:"removeActiveCall",value:function(n){e.activeCallId="",n&&He.removeCall(n),Ae.init()}},{key:"setStartCallTimeout",value:function(n){u(n)&&n>=30&&n<=60&&(e.startCallTimeout=n)}},{key:"getStartCallTimeout",value:function(){return 0===e.startCallTimeout?30:this.startCallTimeout}},{key:"setSendBird",value:function(n){e.sendBird=n}},{key:"getSendBird",value:function(){return e.sendBird}}],(t=null)&&tn(n.prototype,t),r&&tn(n,r),e}();rn.sendBird=null,rn.remoteVideoElement=null,rn.localVideoElement=null,rn.startCallTimeout=0,rn.activeCallId="";var an={CHAT:"chat",START:"start",END:"end",NOT_RENDER:"not_render"};function on(e,n,t,r,a,i,o){try{var l=e[i](o),c=l.value}catch(e){return void t(e)}l.done?n(c):Promise.resolve(c).then(r,a)}function ln(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var cn=null,un=function(){function e(n){var t=n.sendBird,r=void 0===t?null:t;if(function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),cn)return cn;r?(rn.setSendBird(r),cn=this):te.throw(M.SENDBIRD_REQUIRED)}var n,t,r;return n=e,t=null,r=[{key:"init",value:function(n){var t=n.sendBird;try{o.messagePrefix="[SBVC] ",o.info("SendBirdVideoChat > init({ sendBird }): ",t),new e({sendBird:t})}catch(e){throw o.error("SendBirdVideoChat > init({ sendBird }): ",M.SENDBIRD_REQUIRED),e}}},{key:"addVideoChatHandler",value:function(e,n){o.info("SendBirdVideoChat > addVideoChatHandler(identifier, handler): ",e,n),e&&s(e)&&n instanceof re&&nn.add(e,n)}},{key:"removeVideoChatHandler",value:function(e){o.info("SendBirdVideoChat > removeVideoChatHandler(identifier): ",e),e&&s(e)&&nn.remove(e)}},{key:"removeAllVideoChatHandlers",value:function(){o.info("SendBirdVideoChat > removeAllVideoChatHandlers()"),nn.init()}},{key:"startCall",value:function(){var e,n=(e=regeneratorRuntime.mark(function e(n,t,r){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o.info("SendBirdVideoChat > startCall(isAudioCall, callOptions): ",n,t),Je.isConnectedToSendBird()||te.throw(M.SENDBIRD_CONNECTION_REQUIRED),c(n)||te.throw(M.INVALID_PARAMETER,X),(null===t||d(t))&&te.throw(M.INVALID_PARAMETER,H),t instanceof fe||te.throw(M.INVALID_PARAMETER,W),s(t.channelUrl)||te.throw(M.INVALID_PARAMETER,Q),rn.getActiveCall()&&te.throw(M.INVALID_ACTION,j),rn.remoteVideoElement=t.remoteVideoElement,rn.localVideoElement=t.localVideoElement,e.next=12,Je.sendStartCall({isAudioCall:n,callOptions:t});case 12:return a=e.sent,e.abrupt("return",h(r,null,a));case 16:return e.prev=16,e.t0=e.catch(0),o.error("SendBirdVideoChat > startCall(): ",e.t0),e.abrupt("return",h(r,e.t0));case 20:case"end":return e.stop()}},e,null,[[0,16]])}),function(){var n=this,t=arguments;return new Promise(function(r,a){var i=e.apply(n,t);function o(e){on(i,r,a,o,l,"next",e)}function l(e){on(i,r,a,o,l,"throw",e)}o(void 0)})});return function(e,t,r){return n.apply(this,arguments)}}()},{key:"buildCall",value:function(e){try{o.info("SendBirdVideoChat > buildCall(message): ",e);var n=Je.getPayloadFromUserMessage(e);return n?new Fe({payload:n}):null}catch(e){return o.error("SendBirdVideoChat > buildCall(): ",e),null}}},{key:"getCall",value:function(e){return He.getCall(e)}},{key:"getActiveCall",value:function(){return rn.getActiveCall()}},{key:"setStartCallTimeout",value:function(e){rn.setStartCallTimeout(e)}},{key:"getStartCallTimeout",value:function(){return rn.getStartCallTimeout()}},{key:"getRenderingMessageType",value:function(e){var n=an.NOT_RENDER;try{if((e.isFileMessage()||e.isAdminMessage()||e.isUserMessage())&&(n=an.CHAT),Je.isVideoChatMessage(e)){var t=e.data.substring(0,4);n=t===le.STCA?an.START:t===le.ENCA?an.END:an.NOT_RENDER}}catch(e){n=an.NOT_RENDER}return n}},{key:"setLogLevel",value:function(e){o.level=e}},{key:"sendBird",get:function(){return rn.getSendBird()}},{key:"VERSION",get:function(){return"0.9.4"}}],t&&ln(n.prototype,t),r&&ln(n,r),e}();un.VideoChatHandler=re,un.CallOptions=fe,un.VideoChatException=te;var sn={RenderingMessageType:an,EndType:ve,Role:pe};un.VideoChatType=sn;n.default=un}]).default});