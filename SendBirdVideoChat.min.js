!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define("SendBirdVideoChat",[],n):"object"==typeof exports?exports.SendBirdVideoChat=n():e.SendBirdVideoChat=n()}("undefined"!=typeof self?self:this,function(){return function(e){var n={};function t(r){if(n[r])return n[r].exports;var a=n[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,t),a.l=!0,a.exports}return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var a in e)t.d(r,a,function(n){return e[n]}.bind(null,a));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=2)}([function(e,n){!function(){var n,t,r,a,o,i,l,c,u,s,d,f,v,h,p,C,y,m,g,b,E,w,O,A,S,I,_,k,N,R,T,P,D,x,L,V,U,M,j,B,F,G,H,W,Q,J,X,K,z,q,Z,Y,$,ee,ne,te,re=32768,ae=0,oe=1,ie=2,le=6,ce=!1,ue=8192,se=2*re,de=3,fe=258,ve=8192,he=ve,pe=32768,Ce=pe-1,ye=re-1,me=0,ge=4096,be=fe+de+1,Ee=re-be,we=1,Oe=15,Ae=7,Se=29,Ie=256,_e=256,ke=Ie+1+Se,Ne=30,Re=19,Te=16,Pe=17,De=18,xe=2*ke+1,Le=parseInt((15+de-1)/de,10),Ve=null;function Ue(){this.fc=0,this.dl=0}function Me(){this.dyn_tree=null,this.static_tree=null,this.extra_bits=null,this.extra_base=0,this.elems=0,this.max_length=0,this.max_code=0}function je(e,n,t,r){this.good_length=e,this.max_lazy=n,this.nice_length=t,this.max_chain=r}function Be(){this.next=null,this.len=0,this.ptr=[],this.off=0}var Fe=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Ge=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],He=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],We=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Qe=[new je(0,0,0,0),new je(4,4,8,4),new je(4,5,16,8),new je(4,6,32,32),new je(4,4,16,16),new je(8,16,32,32),new je(8,16,128,128),new je(8,32,128,256),new je(32,128,258,1024),new je(32,258,258,4096)];function Je(e){e.next=n,n=e}function Xe(e){return d[re+e]}function Ke(e,n){return d[re+e]=n}function ze(e){Ve[i+o++]=e,i+o===ue&&function(){var e,a;if(0!==o){for(null!==n?(l=n,n=n.next):l=new Be,l.next=null,l.len=l.off=0,e=l,null===t?t=r=e:r=r.next=e,e.len=o-i,a=0;a<e.len;a++)e.ptr[a]=Ve[i+a];o=i=0}var l}()}function qe(e){e&=65535,i+o<ue-2?(Ve[i+o++]=255&e,Ve[i+o++]=e>>>8):(ze(255&e),ze(e>>>8))}function Ze(){p=(p<<Le^255&c[E+de-1])&Ce,C=Xe(p),d[E&ye]=C,Ke(p,E)}function Ye(e,n){mn(n[e].fc,n[e].dl)}function $e(e){return 255&(e<256?W[e]:W[256+(e>>7)])}function en(e,n,t){return e[n].fc<e[t].fc||e[n].fc===e[t].fc&&G[n]<=G[t]}function nn(e,n,t){var r;for(r=0;r<t&&te<ne.length;r++)e[n+r]=255&ne[te++];return r}function tn(e){var n,t,r,a,o=S,i=E,l=b,u=E>Ee?E-Ee:me,s=E+fe,f=c[i+l-1],v=c[i+l];b>=k&&(o>>=2);do{if(c[(n=e)+l]===v&&c[n+l-1]===f&&c[n]===c[i]&&c[++n]===c[i+1]){for(i+=2,n++;i<s;){for(a=!1,r=0;r<8;r+=1)if(n+=1,c[i+=1]!==c[n]){a=!0;break}if(a)break}if(t=fe-(s-i),i=s-fe,t>l){if(w=e,l=t,ce){if(t>=fe)break}else if(t>=N)break;f=c[i+l-1],v=c[i+l]}}}while((e=d[e&ye])>u&&0!=--o);return l}function rn(){var e,n,t=se-A-E;if(-1===t)t--;else if(E>=re+Ee){for(e=0;e<re;e++)c[e]=c[e+re];for(w-=re,E-=re,h-=re,e=0;e<pe;e++)Ke(e,(n=Xe(e))>=re?n-re:me);for(e=0;e<re;e++)n=d[e],d[e]=n>=re?n-re:me;t+=re}O||((e=nn(c,E+A,t))<=0?O=!0:A+=e)}function an(){O||(f=0,v=0,function(){var e,n,t,r,a;if(0!==D[0].dl)return;for(L.dyn_tree=R,L.static_tree=P,L.extra_bits=Fe,L.extra_base=Ie+1,L.elems=ke,L.max_length=Oe,L.max_code=0,V.dyn_tree=T,V.static_tree=D,V.extra_bits=Ge,V.extra_base=0,V.elems=Ne,V.max_length=Oe,V.max_code=0,U.dyn_tree=x,U.static_tree=null,U.extra_bits=He,U.extra_base=0,U.elems=Re,U.max_length=Ae,U.max_code=0,t=0,r=0;r<Se-1;r++)for(Q[r]=t,e=0;e<1<<Fe[r];e++)H[t++]=r;for(H[t-1]=r,a=0,r=0;r<16;r++)for(J[r]=a,e=0;e<1<<Ge[r];e++)W[a++]=r;for(a>>=7;r<Ne;r++)for(J[r]=a<<7,e=0;e<1<<Ge[r]-7;e++)W[256+a++]=r;for(n=0;n<=Oe;n++)M[n]=0;e=0;for(;e<=143;)P[e++].dl=8,M[8]++;for(;e<=255;)P[e++].dl=9,M[9]++;for(;e<=279;)P[e++].dl=7,M[7]++;for(;e<=287;)P[e++].dl=8,M[8]++;for(sn(P,ke+1),e=0;e<Ne;e++)D[e].dl=5,D[e].fc=gn(e,5);cn()}(),function(){var e;for(e=0;e<pe;e++)d[re+e]=0;if(I=Qe[_].max_lazy,k=Qe[_].good_length,ce||(N=Qe[_].nice_length),S=Qe[_].max_chain,E=0,h=0,(A=nn(c,0,2*re))<=0)return O=!0,void(A=0);for(O=!1;A<be&&!O;)rn();for(p=0,e=0;e<de-1;e++)p=(p<<Le^255&c[e])&Ce}(),t=null,o=0,i=0,_<=3?(b=de-1,g=0):(g=de-1,m=!1),l=!1)}function on(e,n,r){var o;return a||(an(),a=!0,0!==A)?(o=ln(e,n,r))===r?r:l?o:(_<=3?function(){for(;0!==A&&null===t;){var e;if(Ze(),C!==me&&E-C<=Ee&&(g=tn(C))>A&&(g=A),g>=de)if(e=pn(E-w,g-de),A-=g,g<=I){g--;do{E++,Ze()}while(0!=--g);E++}else E+=g,g=0,p=((p=255&c[E])<<Le^255&c[E+1])&Ce;else e=pn(0,255&c[E]),A--,E++;for(e&&(hn(0),h=E);A<be&&!O;)rn()}}():function(){for(;0!==A&&null===t;){if(Ze(),b=g,y=w,g=de-1,C!==me&&b<I&&E-C<=Ee&&((g=tn(C))>A&&(g=A),g===de&&E-w>ge&&g--),b>=de&&g<=b){var e;e=pn(E-1-y,b-de),A-=b-1,b-=2;do{E++,Ze()}while(0!=--b);m=!1,g=de-1,E++,e&&(hn(0),h=E)}else m?(pn(0,255&c[E-1])&&(hn(0),h=E),E++,A--):(m=!0,E++,A--);for(;A<be&&!O;)rn()}}(),0===A&&(m&&pn(0,255&c[E-1]),hn(1),l=!0),o+ln(e,o+n,r-o)):(l=!0,0)}function ln(e,n,r){var a,l,c;for(a=0;null!==t&&a<r;){for((l=r-a)>t.len&&(l=t.len),c=0;c<l;c++)e[n+a+c]=t.ptr[t.off+c];var u;if(t.off+=l,t.len-=l,a+=l,0===t.len)u=t,t=t.next,Je(u)}if(a===r)return a;if(i<o){for((l=r-a)>o-i&&(l=o-i),c=0;c<l;c++)e[n+a+c]=Ve[i+c];a+=l,o===(i+=l)&&(o=i=0)}return a}function cn(){var e;for(e=0;e<ke;e++)R[e].fc=0;for(e=0;e<Ne;e++)T[e].fc=0;for(e=0;e<Re;e++)x[e].fc=0;R[_e].fc=1,$=ee=0,K=z=q=0,Z=0,Y=1}function un(e,n){for(var t=j[n],r=n<<1;r<=B&&(r<B&&en(e,j[r+1],j[r])&&r++,!en(e,t,j[r]));)j[n]=j[r],n=r,r<<=1;j[n]=t}function sn(e,n){var t,r,a=[],o=0;for(t=1;t<=Oe;t++)o=o+M[t-1]<<1,a[t]=o;for(r=0;r<=n;r++){var i=e[r].dl;0!==i&&(e[r].fc=gn(a[i]++,i))}}function dn(e){var n,t,r=e.dyn_tree,a=e.static_tree,o=e.elems,i=-1,l=o;for(B=0,F=xe,n=0;n<o;n++)0!==r[n].fc?(j[++B]=i=n,G[n]=0):r[n].dl=0;for(;B<2;){var c=j[++B]=i<2?++i:0;r[c].fc=1,G[c]=0,$--,null!==a&&(ee-=a[c].dl)}for(e.max_code=i,n=B>>1;n>=1;n--)un(r,n);do{n=j[we],j[we]=j[B--],un(r,we),t=j[we],j[--F]=n,j[--F]=t,r[l].fc=r[n].fc+r[t].fc,G[n]>G[t]+1?G[l]=G[n]:G[l]=G[t]+1,r[n].dl=r[t].dl=l,j[we]=l++,un(r,we)}while(B>=2);j[--F]=j[we],function(e){var n,t,r,a,o,i,l=e.dyn_tree,c=e.extra_bits,u=e.extra_base,s=e.max_code,d=e.max_length,f=e.static_tree,v=0;for(a=0;a<=Oe;a++)M[a]=0;for(l[j[F]].dl=0,n=F+1;n<xe;n++)(a=l[l[t=j[n]].dl].dl+1)>d&&(a=d,v++),l[t].dl=a,t>s||(M[a]++,o=0,t>=u&&(o=c[t-u]),i=l[t].fc,$+=i*(a+o),null!==f&&(ee+=i*(f[t].dl+o)));if(0!==v){do{for(a=d-1;0===M[a];)a--;M[a]--,M[a+1]+=2,M[d]--,v-=2}while(v>0);for(a=d;0!==a;a--)for(t=M[a];0!==t;)(r=j[--n])>s||(l[r].dl!==a&&($+=(a-l[r].dl)*l[r].fc,l[r].fc=a),t--)}}(e),sn(r,i)}function fn(e,n){var t,r,a=-1,o=e[0].dl,i=0,l=7,c=4;for(0===o&&(l=138,c=3),e[n+1].dl=65535,t=0;t<=n;t++)r=o,o=e[t+1].dl,++i<l&&r===o||(i<c?x[r].fc+=i:0!==r?(r!==a&&x[r].fc++,x[Te].fc++):i<=10?x[Pe].fc++:x[De].fc++,i=0,a=r,0===o?(l=138,c=3):r===o?(l=6,c=3):(l=7,c=4))}function vn(e,n){var t,r,a=-1,o=e[0].dl,i=0,l=7,c=4;for(0===o&&(l=138,c=3),t=0;t<=n;t++)if(r=o,o=e[t+1].dl,!(++i<l&&r===o)){if(i<c)do{Ye(r,x)}while(0!=--i);else 0!==r?(r!==a&&(Ye(r,x),i--),Ye(Te,x),mn(i-3,2)):i<=10?(Ye(Pe,x),mn(i-3,3)):(Ye(De,x),mn(i-11,7));i=0,a=r,0===o?(l=138,c=3):r===o?(l=6,c=3):(l=7,c=4)}}function hn(e){var n,t,r,a,o;if(a=E-h,X[q]=Z,dn(L),dn(V),r=function(){var e;for(fn(R,L.max_code),fn(T,V.max_code),dn(U),e=Re-1;e>=3&&0===x[We[e]].dl;e--);return $+=3*(e+1)+5+5+4,e}(),(t=ee+3+7>>3)<=(n=$+3+7>>3)&&(n=t),a+4<=n&&h>=0)for(mn((ae<<1)+e,3),bn(),qe(a),qe(~a),o=0;o<a;o++)ze(c[h+o]);else t===n?(mn((oe<<1)+e,3),Cn(P,D)):(mn((ie<<1)+e,3),function(e,n,t){var r;for(mn(e-257,5),mn(n-1,5),mn(t-4,4),r=0;r<t;r++)mn(x[We[r]].dl,3);vn(R,e-1),vn(T,n-1)}(L.max_code+1,V.max_code+1,r+1),Cn(R,T));cn(),0!==e&&bn()}function pn(e,n){if(s[K++]=n,0===e?R[n].fc++:(e--,R[H[n]+Ie+1].fc++,T[$e(e)].fc++,u[z++]=e,Z|=Y),Y<<=1,0==(7&K)&&(X[q++]=Z,Z=0,Y=1),_>2&&0==(4095&K)){var t,r=8*K,a=E-h;for(t=0;t<Ne;t++)r+=T[t].fc*(5+Ge[t]);if(r>>=3,z<parseInt(K/2,10)&&r<parseInt(a/2,10))return!0}return K===ve-1||z===he}function Cn(e,n){var t,r,a,o,i=0,l=0,c=0,d=0;if(0!==K)do{0==(7&i)&&(d=X[c++]),r=255&s[i++],0==(1&d)?Ye(r,e):(Ye((a=H[r])+Ie+1,e),0!==(o=Fe[a])&&mn(r-=Q[a],o),Ye(a=$e(t=u[l++]),n),0!==(o=Ge[a])&&mn(t-=J[a],o)),d>>=1}while(i<K);Ye(_e,e)}var yn=16;function mn(e,n){v>yn-n?(qe(f|=e<<v),f=e>>yn-v,v+=n-yn):(f|=e<<v,v+=n)}function gn(e,n){var t=0;do{t|=1&e,e>>=1,t<<=1}while(--n>0);return t>>1}function bn(){v>8?qe(f):v>0&&ze(f),f=0,v=0}e.exports.deflate=function(e,o){var i,l;ne=e,te=0,function(e){var o;if(e?e<1?e=1:e>9&&(e=9):e=le,_=e,a=!1,O=!1,null===Ve){for(n=t=r=null,Ve=[],c=[],u=[],s=[],d=[],R=[],o=0;o<xe;o++)R[o]=new Ue;for(T=[],o=0;o<2*Ne+1;o++)T[o]=new Ue;for(P=[],o=0;o<ke+2;o++)P[o]=new Ue;for(D=[],o=0;o<Ne;o++)D[o]=new Ue;for(x=[],o=0;o<2*Re+1;o++)x[o]=new Ue;L=new Me,V=new Me,U=new Me,M=[],j=[],G=[],H=[],W=[],Q=[],J=[],X=[]}}(le),l=[];do{i=on(l,l.length,1024)}while(i>0);return ne=null,l},e.exports.DEFAULT_LEVEL=le}()},function(e,n){!function(){var n,t,r,a,o,i,l,c,u,s,d,f,v,h,p,C,y,m=32768,g=0,b=1,E=2,w=9,O=6,A=null,S=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],I=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],_=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],k=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],N=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],R=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function T(){this.next=null,this.list=null}function P(){this.e=0,this.b=0,this.n=0,this.t=null}function D(e,n,t,r,a,o){var i;this.BMAX=16,this.N_MAX=288,this.status=0,this.root=null,this.m=0;var l,c,u,s,d,f,v,h,p,C,y,m,g,b,E,w,O=[],A=[],S=new P,I=[],_=[],k=[];for(w=this.root=null,d=0;d<this.BMAX+1;d++)O[d]=0;for(d=0;d<this.BMAX+1;d++)A[d]=0;for(d=0;d<this.BMAX;d++)I[d]=null;for(d=0;d<this.N_MAX;d++)_[d]=0;for(d=0;d<this.BMAX+1;d++)k[d]=0;l=n>256?e[256]:this.BMAX,h=e,p=0,d=n;do{O[h[p]]++,p++}while(--d>0);if(O[0]===n)return this.root=null,this.m=0,void(this.status=0);for(f=1;f<=this.BMAX&&0===O[f];f++);for(v=f,o<f&&(o=f),d=this.BMAX;0!==d&&0===O[d];d--);for(u=d,o>d&&(o=d),g=1<<f;f<d;f++,g<<=1)if((g-=O[f])<0)return this.status=2,void(this.m=o);if((g-=O[d])<0)return this.status=2,void(this.m=o);for(O[d]+=g,k[1]=f=0,h=O,p=1,m=2;--d>0;)k[m++]=f+=h[p++];h=e,p=0,d=0;do{0!==(f=h[p++])&&(_[k[f]++]=d)}while(++d<n);for(n=k[u],k[0]=d=0,h=_,p=0,s=-1,y=A[0]=0,C=null,b=0;v<=u;v++)for(i=O[v];i-- >0;){for(;v>y+A[1+s];){if(y+=A[1+s],s++,b=(b=u-y)>o?o:b,(c=1<<(f=v-y))>i+1)for(c-=i+1,m=v;++f<b&&!((c<<=1)<=O[++m]);)c-=O[m];for(y+f>l&&y<l&&(f=l-y),b=1<<f,A[1+s]=f,C=[],E=0;E<b;E++)C[E]=new P;(w=w?w.next=new T:this.root=new T).next=null,w.list=C,I[s]=C,s>0&&(k[s]=d,S.b=A[s],S.e=16+f,S.t=C,f=(d&(1<<y)-1)>>y-A[s],I[s-1][f].e=S.e,I[s-1][f].b=S.b,I[s-1][f].n=S.n,I[s-1][f].t=S.t)}for(S.b=v-y,p>=n?S.e=99:h[p]<t?(S.e=h[p]<256?16:15,S.n=h[p++]):(S.e=a[h[p]-t],S.n=r[h[p++]-t]),c=1<<v-y,f=d>>y;f<b;f+=c)C[f].e=S.e,C[f].b=S.b,C[f].n=S.n,C[f].t=S.t;for(f=1<<v-1;0!=(d&f);f>>=1)d^=f;for(d^=f;(d&(1<<y)-1)!==k[s];)y-=A[s],s--}this.m=A[1],this.status=0!==g&&1!==u?1:0}function x(e){for(;l<e;)i|=(C.length===y?-1:255&C[y++])<<l,l+=8}function L(e){return i&S[e]}function V(e){i>>=e,l-=e}function U(e,r,a){var o,i,l;if(0===a)return 0;for(l=0;;){for(x(h),o=(i=f.list[L(h)]).e;o>16;){if(99===o)return-1;V(i.b),x(o-=16),o=(i=i.t[L(o)]).e}if(V(i.b),16!==o){if(15===o)break;for(x(o),s=i.n+L(o),V(o),x(p),o=(i=v.list[L(p)]).e;o>16;){if(99===o)return-1;V(i.b),x(o-=16),o=(i=i.t[L(o)]).e}for(V(i.b),x(o),d=t-i.n-L(o),V(o);s>0&&l<a;)s--,d&=m-1,t&=m-1,e[r+l++]=n[t++]=n[d++];if(l===a)return a}else if(t&=m-1,e[r+l++]=n[t++]=i.n,l===a)return a}return c=-1,l}function M(e,r,a){var o;if(V(o=7&l),x(16),o=L(16),V(16),x(16),o!==(65535&~i))return-1;for(V(16),s=o,o=0;s>0&&o<a;)s--,t&=m-1,x(8),e[r+o++]=n[t++]=L(8),V(8);return 0===s&&(c=-1),o}function j(e,n,t){if(!A){var i,l,c=[];for(i=0;i<144;i++)c[i]=8;for(;i<256;i++)c[i]=9;for(;i<280;i++)c[i]=7;for(;i<288;i++)c[i]=8;if(0!==(l=new D(c,288,257,I,_,a=7)).status)return-1;for(A=l.root,a=l.m,i=0;i<30;i++)c[i]=5;if((l=new D(c,30,0,k,N,o=5)).status>1)return A=null,-1;r=l.root,o=l.m}return f=A,v=r,h=a,p=o,U(e,n,t)}function B(e,n,t){var r,a,o,i,l,c,u,s,d,C=[];for(r=0;r<316;r++)C[r]=0;if(x(5),u=257+L(5),V(5),x(5),s=1+L(5),V(5),x(4),c=4+L(4),V(4),u>286||s>30)return-1;for(a=0;a<c;a++)x(3),C[R[a]]=L(3),V(3);for(;a<19;a++)C[R[a]]=0;if(0!==(d=new D(C,19,19,null,null,h=7)).status)return-1;for(f=d.root,h=d.m,i=u+s,r=o=0;r<i;)if(x(h),V(a=(l=f.list[L(h)]).b),(a=l.n)<16)C[r++]=o=a;else if(16===a){if(x(2),a=3+L(2),V(2),r+a>i)return-1;for(;a-- >0;)C[r++]=o}else if(17===a){if(x(3),a=3+L(3),V(3),r+a>i)return-1;for(;a-- >0;)C[r++]=0;o=0}else{if(x(7),a=11+L(7),V(7),r+a>i)return-1;for(;a-- >0;)C[r++]=0;o=0}if(d=new D(C,u,257,I,_,h=w),0===h&&(d.status=1),0!==d.status&&1!==d.status)return-1;for(f=d.root,h=d.m,r=0;r<s;r++)C[r]=C[r+u];return d=new D(C,s,0,k,N,p=O),v=d.root,0===(p=d.m)&&u>257?-1:0!==d.status?-1:U(e,n,t)}function F(e,r,a){var o,i;for(o=0;o<a;){if(u&&-1===c)return o;if(s>0){if(c!==g)for(;s>0&&o<a;)s--,d&=m-1,t&=m-1,e[r+o++]=n[t++]=n[d++];else{for(;s>0&&o<a;)s--,t&=m-1,x(8),e[r+o++]=n[t++]=L(8),V(8);0===s&&(c=-1)}if(o===a)return o}if(-1===c){if(u)break;x(1),0!==L(1)&&(u=!0),V(1),x(2),c=L(2),V(2),f=null,s=0}switch(c){case g:i=M(e,r+o,a-o);break;case b:i=f?U(e,r+o,a-o):j(e,r+o,a-o);break;case E:i=f?U(e,r+o,a-o):B(e,r+o,a-o);break;default:i=-1}if(-1===i)return u?0:-1;o+=i}return o}e.exports.inflate=function(e){var r,a=[];n||(n=[]),t=0,i=0,l=0,c=-1,u=!1,s=d=0,f=null,C=e,y=0;do{r=F(a,a.length,1024)}while(r>0);return C=null,a}}()},function(e,n,t){e.exports=t(3)},function(e,n,t){"use strict";function r(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}t.r(n);var a={OFF:"OFF",ERROR:"ERROR",INFO:"INFO",ALL:"ALL"},o={OFF:{level:0,name:a.OFF},ERROR:{level:1,name:a.ERROR},INFO:{level:4,name:a.INFO},ALL:{level:999,name:a.ALL}},i=new(function(){function e(){for(var n in function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),a)this[n]=a[n];var t=a.OFF;Object.defineProperty(this,"level",{get:function(){return t},set:function(e){a[e]&&(t=a[e])}});var r="";Object.defineProperty(this,"messagePrefix",{get:function(){return r},set:function(e){"string"==typeof e&&(r=e)}})}var n,t,i;return n=e,(t=[{key:"_enabledFor",value:function(e){try{return o[this.level].level>=o[e].level}catch(e){return!1}}},{key:"_permit",value:function(e){var n=e===a.INFO?"log":e.toLowerCase();if(this._enabledFor(e)&&console&&console[n]){for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];var i,l;if("string"==typeof r[0])r[0]=this.messagePrefix+r[0],(i=console)[n].apply(i,r);else(l=console)[n].apply(l,[this.messagePrefix].concat(r))}}},{key:"info",value:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];this._permit.apply(this,[a.INFO].concat(n))}},{key:"error",value:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];this._permit.apply(this,[a.ERROR].concat(n))}}])&&r(n.prototype,t),i&&r(n,i),e}());function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var c=function(e){return"boolean"==typeof e},u=function(e){return"number"==typeof e},s=function(e){return"string"==typeof e},d=function(e){return"function"==typeof e},f=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!d(e))return n?Promise.reject(n):Promise.resolve(t);n?e(n):e(n,t)},v=function e(){for(var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=0;t<(arguments.length<=1?0:arguments.length-1);t++){var r=t+1<1||arguments.length<=t+1?void 0:arguments[t+1];if(r)for(var a in r)r.hasOwnProperty(a)&&("object"===l(r[a])?n[a]=e(n[a],r[a]):n[a]=r[a])}return n},h=function(e){var n=e.audio,t=e.video;return new Promise(function(e,r){navigator.mediaDevices.getUserMedia({audio:n,video:t}).then(function(n){return e(n)}).catch(function(e){return r(e)})})},p=t(0),C=t(1),y=function(){for(var e=[],n=0;n<256;n++){for(var t=n,r=0;r<8;r++)1&t?t=3988292384^t>>>1:t>>>=1;e[n]=t>>>0}return e}(),m=function(e){return(function(e){for(var n=-1,t=0;t<e.length;t++)n=n>>>8^y[255&(n^e[t])];return-1^n}(e)>>>0).toString(16)},g=function(e,n){n.push(255&e)},b=function(e,n){n.push(255&e),n.push(e>>>8)},E=function(e,n){b(65535&e,n),b(e>>>16,n)},w=function(e){return e.shift()},O=function(e){return e.shift()|e.shift()<<8},A=function(e){var n=O(e),t=O(e);return t>32768?((t-=32768)<<16|n)+32768*Math.pow(2,16):t<<16|n},S="undefined"!=typeof Uint8Array?Uint8Array:Array,I="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_=function(){for(var e=I.length,n=[],t=[],r=0;r<e;r++)n[r]=I[r],t[I.charCodeAt(r)]=r;return t["-".charCodeAt(0)]=62,t["_".charCodeAt(0)]=63,{lookup:n,revLookup:t}}(),k=_.lookup,N=_.revLookup,R=function(e){for(var n=function(e){var n=e.length;if(n%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=-1===e.indexOf("=")?n:e.indexOf("=");return{validLen:t,placeHoldersLen:t===n?0:4-t%4}}(e=e.replace(/(\r\n|\n|\r)/gm,"")),t=n.validLen,r=n.placeHoldersLen,a=new S(function(e,n){return 3*(e+n)/4-n}(t,r)),o=0,i=r>0?t-4:t,l=0;l<i;l+=4){var c=N[e.charCodeAt(l)]<<18|N[e.charCodeAt(l+1)]<<12|N[e.charCodeAt(l+2)]<<6|N[e.charCodeAt(l+3)];a[o++]=c>>16&255,a[o++]=c>>8&255,a[o++]=255&c}if(2===r){var u=N[e.charCodeAt(l)]<<2|N[e.charCodeAt(l+1)]>>4;a[o++]=255&u}if(1===r){var s=N[e.charCodeAt(l)]<<10|N[e.charCodeAt(l+1)]<<4|N[e.charCodeAt(l+2)]>>2;a[o++]=s>>8&255,a[o++]=255&s}return a},T=function(e,n,t){for(var r,a=[],o=n;o<t;o+=3){var i=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]);a.push(k[(r=i)>>18&63]+k[r>>12&63]+k[r>>6&63]+k[63&r])}return a.join("")},P=function(e){return function(e){for(var n=[],t=e.length,r=t%3,a=t-r,o=0;o<a;o+=16383){var i=o+16383>a?a:o+16383;n.push(T(e,o,i))}if(1===r){var l=e[t-1];n.push(k[l>>2]+k[l<<4&63]+"==")}else if(2===r){var c=(e[t-2]<<8)+e[t-1];n.push(k[c>>10]+k[c>>4&63]+k[c<<2&63]+"=")}return n.join("")}(function(e){var n=[];return s(e)&&(e=Array.prototype.map.call(e,function(e){return e.charCodeAt(0)})),g(31,n),g(139,n),g(8,n),g(0,n),E(parseInt(Date.now()/1e3,10),n),g(0,n),g(3,n),Object(p.deflate)(e,6).forEach(function(e){return g(e,n)}),E(parseInt(m(e),16),n),E(e.length,n),n}(e))},D=function(e){var n=function(e){for(var n=Array.prototype.slice.call(e,0),t=0;t<n.length;t++)n[t]=n[t]<0?n[t]+256:n[t];var r=w(n),a=w(n);if(31!==r||139!==a)throw"Not a GZIP file";if(8!==w(n))throw"Unsupported compression method";w(n),A(n),w(n),w(n);var o=Object(C.inflate)(n.splice(0,n.length-8));if(A(n)>>>0!==parseInt(m(o),16))throw"Checksum does not match";if(A(n)!==o.length)throw"Size of decompressed file not correct";return o}(R(e));return n.map(function(e){return String.fromCharCode(e)}).join("")},x={UNKNOWN:{code:82e4,message:"Unknown error occurred."},SENDBIRD_CONNECTION_REQUIRED:{code:820100,message:"SendBird connection is required."},SENDBIRD_REQUIRED:{code:820130,message:"SendBird instance is required."},INVALID_ACTION:{code:820200,message:"Invalid action."},USER_MESSAGE_REQUIRED:{code:820201,message:"VideoChat UserMessage must be required."},ACCEPTING_FAIL:{code:820300,message:"Can not accept call."},INVALID_PARAMETER:{code:820400,message:"Invalid parameter."},UNSUITABLE_CHANNEL:{code:820401,message:"The channel is not suitable."},CALL_ON_GOING:{code:900600,message:"Call is already going on in this channel."},NO_CALL_GOING_ON:{code:900601,message:"There is no call going on in this channel."}},L=v({},x);function V(e){return(V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function U(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function M(e,n){return!n||"object"!==V(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function j(e){var n="function"==typeof Map?new Map:void 0;return(j=function(e){if(null===e||(t=e,-1===Function.toString.call(t).indexOf("[native code]")))return e;var t;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,r)}function r(){return B(e,arguments,G(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),F(r,e)})(e)}function B(e,n,t){return(B=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,n,t){var r=[null];r.push.apply(r,n);var a=new(Function.bind.apply(e,r));return t&&F(a,t.prototype),a}).apply(null,arguments)}function F(e,n){return(F=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function G(e){return(G=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}delete L.USER_MESSAGE_REQUIRED,delete L.NO_CALL_GOING_ON;var H="VideoChatException",W=function(e){function n(e){var t,r=e.message,a=e.code;return function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),(t=M(this,G(n).call(this))).message=r,t.name=H,t.code=a||0,t}var t,r,a;return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&F(e,n)}(n,j(Error)),t=n,a=[{key:"create",value:function(){return new n(arguments.length>0&&void 0!==arguments[0]?arguments[0]:x.UNKNOWN)}},{key:"throw",value:function(e){var t=e.error,r=e.message,a=e.code;if(r&&a&&(t=new n({message:r,code:a})),t instanceof n)throw t}},{key:"ErrorCode",get:function(){var e={};for(var n in L)e[n]=x[n].code;return e}}],(r=null)&&U(t.prototype,r),a&&U(t,a),n}();var Q=function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.onStartSent=function(e,n){},this.onStartReceived=function(e){},this.onAcceptSent=function(e){},this.onAcceptReceived=function(e){},this.onEndSent=function(e,n){},this.onEndReceived=function(e){},this.onConnected=function(e){},this.onOpponentAudioStateChanged=function(e){},this.onOpponentVideoStateChanged=function(e){}},J={START:"start"},X={END:"end",DECLINE:"decline",CANCEL:"cancel",TIMEOUT:"timeout",UNKNOWN:"unknown"},K={OFFER:"offer",ANSWER:"answer",CANDIDATE:"candidate",AUDIO:"audio",VIDEO:"video"},z={SGNL:"SGNL",STCA:"STCA",ENCA:"ENCA"},q="SB_VIDEOCHAT",Z="SB_VIDEOCHAT";var Y=function e(n){var t=n.user_id,r=n.nickname,a=n.profile_url,o=n.is_audio_enabled,i=void 0!==o&&o,l=n.is_video_enabled,u=void 0!==l&&l;if(function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),t&&r&&a){var d=t;Object.defineProperty(this,"userId",{get:function(){return d}});var f="";Object.defineProperty(this,"nickname",{get:function(){return f},set:function(e){s(e)&&(f=e)}}),this.nickname=r;var v="";Object.defineProperty(this,"profileUrl",{get:function(){return v},set:function(e){s(e)&&(v=e)}}),this.profileUrl=a;var h=i;Object.defineProperty(this,"isAudioEnabled",{get:function(){return h},set:function(e){c(e)&&(h=e)}});var p=u;Object.defineProperty(this,"isVideoEnabled",{get:function(){return p},set:function(e){c(e)&&(p=e)}})}else W.throw(x.USER_MESSAGE_REQUIRED)};function $(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ee=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.channelUrl,r=void 0===t?"":t,a=n.localVideoElement,o=void 0===a?null:a,i=n.remoteVideoElement,l=void 0===i?null:i,d=n.isVideoEnabled,f=void 0===d||d,v=n.isAudioEnabled,h=void 0===v||v,p=n.videoWidth,C=void 0===p?0:p,y=n.videoHeight,m=void 0===y?0:y,g=n.videoFPS,b=void 0===g?0:g;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e);var E="";Object.defineProperty(this,"channelUrl",{get:function(){return E},set:function(e){s(e)&&(E=e)}}),this.channelUrl=r;var w=null;Object.defineProperty(this,"localVideoElement",{get:function(){return w},set:function(e){(null==e||e instanceof Element)&&(w=e)}}),this.localVideoElement=o;var O=null;Object.defineProperty(this,"remoteVideoElement",{get:function(){return O},set:function(e){(null==e||e instanceof Element)&&(O=e)}}),this.remoteVideoElement=l;var A=!0;Object.defineProperty(this,"isVideoEnabled",{get:function(){return A},set:function(e){c(e)&&(A=e)}}),this.isVideoEnabled=f;var S=!0;Object.defineProperty(this,"isAudioEnabled",{get:function(){return S},set:function(e){c(e)&&(S=e)}}),this.isAudioEnabled=h;var I=0;Object.defineProperty(this,"videoWidth",{get:function(){return I},set:function(e){u(e)&&e>0&&(I=e)}}),this.videoWidth=C;var _=0;Object.defineProperty(this,"videoHeight",{get:function(){return _},set:function(e){u(e)&&e>0&&(_=e)}}),this.videoHeight=m;var k=0;Object.defineProperty(this,"videoFPS",{get:function(){return k},set:function(e){u(e)&&e>0&&(k=e)}}),this.videoFPS=b}var n,t,r;return n=e,r=[{key:"isCallOptions",value:function(n){return n instanceof e}}],(t=[{key:"getConstraints",value:function(e){var n={audio:!0,video:!e};return e||this.isVideoEnabled&&(this.videoWidth>0||this.videoHeight>0||this.videoFPS>0)&&(n.video={},this.videoWidth>0&&(n.video.width=this.videoWidth),this.videoHeight>0&&(n.video.height=this.videoHeight),this.videoFPS>0&&(n.video.frameRate={ideal:this.videoFPS})),n}}])&&$(n.prototype,t),r&&$(n,r),e}(),ne={NONE:"none",CONNECTING:"connecting",CONNECTED:"connected",DISCONNECTED:"disconnected"},te={NONE:"none",END:"end",DECLINE:"decline",CANCEL:"cancel",TIMEOUT:"timeout",UNKNOWN:"unknown"},re={CALLER:"caller",CALLEE:"callee",NONE:"none"};var ae=function e(n){var t=n.call_id,r=n.channel_url,a=n.message_id,o=n.caller,i=n.callee,l=n.credentials,c=void 0===l?{}:l,s=n.turn_server,d=void 0===s?"":s,f=n.is_audio_call,v=void 0!==f&&f,h=n.ender,p=void 0===h?null:h,C=n.type,y=void 0===C?te.NONE:C,m=n.period,g=void 0===m?0:m,b=n.state,E=void 0===b?ne.NONE:b,w=n.role,O=void 0===w?re.NONE:w;if(function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),t&&r&&a&&o&&i){var A=t;Object.defineProperty(this,"callId",{get:function(){return A}});var S=r;Object.defineProperty(this,"channelUrl",{get:function(){return S}});var I=a;Object.defineProperty(this,"messageId",{get:function(){return I}}),this.caller=new Y(o),this.callee=new Y(i);var _=v;Object.defineProperty(this,"isAudioCall",{get:function(){return _},set:function(e){_=e}});var k=Ge.getSendBird().currentUser.userId;if(this._iceServers=[],c.hasOwnProperty("caller")&&c.hasOwnProperty("callee")){var N=d,R=o.user_id===k?c.caller:c.callee;this._iceServers=[{username:R.username,credential:R.password,urls:N}]}this.enderId=p?p.user_id:null,Object.defineProperty(this,"ender",{get:function(){var e=null;return this.enderId&&(e=this.caller.userId===this.enderId?this.caller:this.callee),e}});var T=te.NONE;Object.defineProperty(this,"endType",{get:function(){return T},set:function(e){Object.values(te).indexOf(e)>-1&&(T=e)}}),this.endType=y;var P=0;Object.defineProperty(this,"period",{get:function(){return P},set:function(e){u(e)&&(P=e)}}),this.period=g;var D=ne.NONE;Object.defineProperty(this,"state",{get:function(){return D},set:function(e){Object.values(ne).indexOf(e)>-1&&(D=e)}}),this.state=E;var L=O;Object.defineProperty(this,"myRole",{get:function(){return L}})}else W.throw(x.USER_MESSAGE_REQUIRED)};function oe(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ie=null,le=function(){function e(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),ie)return ie;this.remainingMsec=n,this.timeoutFn=t,this.startTimestamp=0,this.checker=null,ie=this}var n,t,r;return n=e,(t=[{key:"start",value:function(){var e=this;this.startTimestamp=(new Date).getTime(),this.checker=setInterval(function(){(new Date).getTime()-e.startTimestamp>=e.remainingMsec&&(d(e.timeoutFn)&&e.timeoutFn(),e.stop())},1e3)}},{key:"stop",value:function(){clearInterval(this.checker),this.checker=null}}])&&oe(n.prototype,t),r&&oe(n,r),e}();function ce(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ue=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,r;return n=e,r=[{key:"init",value:function(){e.timer=null}},{key:"startTimer",value:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=0;switch(n){case z.STCA:r=1e3*Ge.getStartCallTimeout();break;case z.SGNL:r=2e4;break;default:i.info("startTimer() - type is not valid: ",n)}var a=new le(r,t);e.timer=a,a.start()}},{key:"stopTimer",value:function(){var n=e.timer;n&&(n.stop(),e.init())}},{key:"updateTimer",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};e.timer.timeoutFn=n}}],(t=null)&&ce(n.prototype,t),r&&ce(n,r),e}();function se(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}ue.timer=null;var de=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,r;return n=e,r=[{key:"init",value:function(){var n=e.peerConnection;n&&n.init(),e.peerConnection=null}},{key:"setPeerConnectionClient",value:function(n){e.peerConnection=n}},{key:"getPeerConnectionClient",value:function(){return e.peerConnection}}],(t=null)&&se(n.prototype,t),r&&se(n,r),e}();function fe(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}de.peerConnection=null;var ve="relay",he="connected",pe="connected",Ce=function(e){return new RTCPeerConnection({iceServers:e,iceTransportPolicy:ve})},ye=function(){function e(n){var t=n.iceServers,r=n.callId;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.peerConnection=Ce(t),this.definePeerConnectionEvent(),this.callId=r,this.alreadyConnected=!1,this.remoteStream=null,this.localStream=null}var n,t,r;return n=e,(t=[{key:"init",value:function(){this.callId=null,this.alreadyConnected=!1,this.remoteStream=null,this.localStream=null,this.peerConnection=null}},{key:"definePeerConnectionEvent",value:function(){var e=this;this.peerConnection.onicecandidate=function(n){var t=n.candidate;i.info("onicecandidate(): ",t,n),t&&t.candidate.indexOf("typ relay ")>-1&&Te.sendCandidate({callId:e.callId,candidate:t}).then(function(e){return i.info("sendCandidate() succeed: ",e)}).catch(function(e){return i.error("sendCandidate() failed: ",e)})},this.peerConnection.oniceconnectionstatechange=function(n){if(i.info("oniceconnectionstatechange(): ",n,e.peerConnection),e.peerConnection){var t=e.peerConnection,r=t.iceConnectionState,a=t.connectionState;if(r===pe&&a===he&&(ue.stopTimer(),e.callId&&!e.alreadyConnected)){e.alreadyConnected=!0;var o=e.callId;_e.getCall(o).state=ne.CONNECTED,Be.runOnConnected(_e.getCall(o))}}},this.peerConnection.ontrack=function(n){i.info("ontrack(): ",n.streams,n),e.updateRemoteStream(n.streams[0])},this.peerConnection.onconnectionstatechange=function(n){if(i.info("onconnectionstatechange(): ",n,e.peerConnection),e.peerConnection){var t=e.peerConnection,r=t.iceConnectionState,a=t.connectionState;if(r===pe&&a===he&&(ue.stopTimer(),e.callId&&!e.alreadyConnected)){e.alreadyConnected=!0;var o=e.callId;_e.getCall(o).state=ne.CONNECTED,Be.runOnConnected(_e.getCall(o))}}}}},{key:"updateRemoteStream",value:function(e){var n=this;try{e.getTracks().forEach(function(t){return n.peerConnection.addTrack(t,e)})}catch(e){i.info("updateRemoteStream() > addTrack: ",e)}this.remoteStream=e,Ge.remoteVideoElement&&(Ge.remoteVideoElement.srcObject=e)}},{key:"updateLocalStream",value:function(e){var n=this;this.peerConnection&&e&&e.getTracks().forEach(function(t){try{n.peerConnection.addTrack(t,e)}catch(e){i.info("updateLocalStream() > addTrack: ",e)}}),this.localStream=e,Ge.localVideoElement&&(Ge.localVideoElement.srcObject=e)}},{key:"enableLocalVideo",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=_e.getCall(this.callId);(n.myRole===re.CALLER?n.caller:n.callee).isVideoEnabled=e;var t=this.localStream.getVideoTracks();t&&t.length>0&&(this.localStream.getVideoTracks()[0].enabled=e,Te.sendVideoCall({callId:this.callId,isEnabled:e}))}},{key:"enableLocalAudio",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=_e.getCall(this.callId);(n.myRole===re.CALLER?n.caller:n.callee).isAudioEnabled=e;var t=this.localStream.getAudioTracks();t&&t.length>0&&(this.localStream.getAudioTracks()[0].enabled=e,Te.sendAudioCall({callId:this.callId,isEnabled:e}))}}])&&fe(n.prototype,t),r&&fe(n,r),e}();function me(e){return(me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ge(e,n,t,r,a,o,i){try{var l=e[o](i),c=l.value}catch(e){return void t(e)}l.done?n(c):Promise.resolve(c).then(r,a)}function be(e){return function(){var n=this,t=arguments;return new Promise(function(r,a){var o=e.apply(n,t);function i(e){ge(o,r,a,i,l,"next",e)}function l(e){ge(o,r,a,i,l,"throw",e)}i(void 0)})}}function Ee(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function we(e,n){return!n||"object"!==me(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function Oe(e){return(Oe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ae(e,n){return(Ae=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}var Se=function(e){function n(e){var t=e.payload;return function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),we(this,Oe(n).call(this,t))}var t,r,a;return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&Ae(e,n)}(n,ae),t=n,(r=[{key:"accept",value:function(){var e=be(regeneratorRuntime.mark(function e(n,t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,Te.isConnectedToSendBird()||W.throw(x.SENDBIRD_CONNECTION_REQUIRED),ee.isCallOptions(n)&&s(n.channelUrl)||W.throw(x.INVALID_PARAMETER),Ge.getActiveCall()&&W.throw(x.INVALID_ACTION),Ge.remoteVideoElement=n.remoteVideoElement,Ge.localVideoElement=n.localVideoElement,e.next=8,Te.sendOfferCall({call:this,callOptions:n});case 8:return r=e.sent,i.info("accept(): ",n,r),e.abrupt("return",f(t,null,r));case 13:return e.prev=13,e.t0=e.catch(0),i.error("accept(): ",e.t0),e.abrupt("return",f(t,e.t0));case 17:case"end":return e.stop()}},e,this,[[0,13]])}));return function(n,t){return e.apply(this,arguments)}}()},{key:"end",value:function(){var e=be(regeneratorRuntime.mark(function e(n){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Te.sendEndCall({call:this});case 3:return t=e.sent,i.info("end(): ",t),e.abrupt("return",f(n,null,t));case 8:return e.prev=8,e.t0=e.catch(0),i.error("end(): ",e.t0),e.abrupt("return",f(n,e.t0));case 12:case"end":return e.stop()}},e,this,[[0,8]])}));return function(n){return e.apply(this,arguments)}}()},{key:"startVideo",value:function(){try{var e=Ge.getActiveCall();e&&e.callId===this.callId||W.throw(x.INVALID_ACTION),de.getPeerConnectionClient().enableLocalVideo(!0)}catch(e){i.error("startVideo(): ",e)}}},{key:"stopVideo",value:function(){try{var e=Ge.getActiveCall();e&&e.callId===this.callId||W.throw(x.INVALID_ACTION),de.getPeerConnectionClient().enableLocalVideo(!1)}catch(e){i.error("stopVideo(): ",e)}}},{key:"muteMicrophone",value:function(){try{var e=Ge.getActiveCall();e&&e.callId===this.callId||W.throw(x.INVALID_ACTION),de.getPeerConnectionClient().enableLocalAudio(!1)}catch(e){i.error("muteMicrophone(): ",e)}}},{key:"unmuteMicrophone",value:function(){try{var e=Ge.getActiveCall();e&&e.callId===this.callId||W.throw(x.INVALID_ACTION),de.getPeerConnectionClient().enableLocalAudio(!0)}catch(e){i.error("unmuteMicrophone(): ",e)}}}])&&Ee(t.prototype,r),a&&Ee(t,a),n}();function Ie(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var _e=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,r;return n=e,r=[{key:"init",value:function(){e.calls={}}},{key:"addCall",value:function(n){e.calls[n.callId]=n}},{key:"getCall",value:function(n){return e.calls[n]}},{key:"removeCall",value:function(n){delete e.calls[n]}},{key:"updateMediaEnabledFromConstraints",value:function(e){var n=e.call,t=e.constraints,r=e.isMine,a=t.audio,o=t.video;if(n){var i=null;(i=r?n.myRole===re.CALLER?n.caller:n.callee:n.myRole===re.CALLER?n.callee:n.caller)&&(i.isAudioEnabled=a,i.isVideoEnabled=!!o)}return n}},{key:"updateSignalCall",value:function(n){var t=n.call_id,r=n.type,a=n.is_enabled,o=e.calls[t];return o&&(r===K.OFFER||r===K.ANSWER?o.state=ne.CONNECTING:r===K.AUDIO?o.myRole===re.CALLER?o.callee.isAudioEnabled=a:o.myRole===re.CALLEE&&(o.caller.isAudioEnabled=a):r===K.VIDEO&&(o.myRole===re.CALLER?o.callee.isVideoEnabled=a:o.myRole===re.CALLEE&&(o.caller.isVideoEnabled=a))),o}},{key:"updateEndCall",value:function(n){var t=n.call_id,r=n.ender,a=n.type,o=n.period,i=n.is_audio_call,l=n.caller,c=n.callee,u=e.calls[t];if(u){if(u.caller=new Y(l),u.callee=new Y(c),u.isAudioCall=i,r){u.enderId=r.user_id;var s=u.myRole===re.CALLER?u.caller:u.callee;s.nickname=r.nickname,s.profileUrl=r.profile_url}u.endType=a,u.period=o,u.state=ne.DISCONNECTED}return u}},{key:"updateCallerCallee",value:function(n){var t=n.callId,r=n.sender;try{var a=e.calls[t];return a&&(a.caller.userId===r.userId?(a.caller.nickname=r.nickname,a.caller.profileUrl=r.profileUrl):a.callee.userId===r.userId?(a.callee.nickname=r.nickname,a.callee.profileUrl=r.profileUrl):i.error("updateCallerCallee() > caller and callee are not matched with sender")),a}catch(e){i.error("updateCallerCallee(): ",e)}}}],(t=null)&&Ie(n.prototype,t),r&&Ie(n,r),e}();function ke(e,n,t,r,a,o,i){try{var l=e[o](i),c=l.value}catch(e){return void t(e)}l.done?n(c):Promise.resolve(c).then(r,a)}function Ne(e){return function(){var n=this,t=arguments;return new Promise(function(r,a){var o=e.apply(n,t);function i(e){ke(o,r,a,i,l,"next",e)}function l(e){ke(o,r,a,i,l,"throw",e)}i(void 0)})}}function Re(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}_e.calls={};var Te=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,r;return n=e,t=null,r=[{key:"isConnectedToSendBird",value:function(){try{var e=Ge.getSendBird();return e.currentUser&&e.currentUser.userId&&"CLOSED"!==e.getConnectionState()}catch(e){return i.error("isConnectedToSendBird: ",e),!1}}},{key:"send",value:function(n){var t=n.channel,r=n.messageData,a=n.callId,o=void 0===a?null:a;return new Promise(function(n,a){try{e.isConnectedToSendBird()||W.throw(x.SENDBIRD_CONNECTION_REQUIRED);var l=Ge.getSendBird(),c=new l.UserMessageParams;c.message=q,c.customType=o?"".concat(Z,"_").concat(o):Z,c.data=r,t.sendUserMessage(c,function(e,t){if(l.getErrorFirstCallback()){var r=e;e=t,t=r}t?(i.error("channel.sendUserMessage(): ",t,c),a(W.create(t))):n(e)})}catch(e){i.error("send(): ",e),a(W.create(x.UNKNOWN))}})}},{key:"getSendBirdGroupChannel",value:function(e){return new Promise(function(n,t){try{var r=Ge.getSendBird();r.GroupChannel.getChannel(e,function(a,o){if(r.getErrorFirstCallback()){var l=a;a=o,o=l}o?(i.error("sendBird.GroupChannel.getChannel: ",o,e),t(W.create(o))):2!==a.members.length||a.isPublic||a.isSuper?t(W.create(x.UNSUITABLE_CHANNEL)):n(a)})}catch(e){i.error("getSendBirdGroupChannel(): ",e),t(W.create(x.UNKNOWN))}})}},{key:"sendStartCall",value:function(){var n=Ne(regeneratorRuntime.mark(function n(t){var r,a,o,l,c,u,s,d,f,v,p,C,y,m;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.isAudioCall,a=t.callOptions,n.prev=1,o=a.channelUrl,l=a.getConstraints(r),n.next=6,e.getSendBirdGroupChannel(o);case 6:return c=n.sent,i.info("sendStartCall() > getChannel(): ",c),ue.startTimer(z.STCA),u=e.buildStart({constraints:{audio:a.isAudioEnabled,video:a.isVideoEnabled},isAudioCall:r}),n.next=12,e.send({channel:c,messageData:u});case 12:return s=n.sent,i.info("sendStartCall() > sendMessage(): ",s),(d=e.getPayloadFromUserMessage(s)).state=ne.CONNECTING,d.role=re.CALLER,f=new Se({payload:d}),Ge.setActiveCall(f),i.info("sendStartCall() > create Call: ",f),v=function(){var n=Ne(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:i.info("sendStartCall() > timeout > sendTimeoutCall()"),e.sendTimeoutCall(f);case 2:case"end":return n.stop()}},n)}));return function(){return n.apply(this,arguments)}}(),ue.updateTimer(v),i.info("sendStartCall() > update timeout function"),de.init(),p=f._iceServers,C=f.callId,y=new ye({iceServers:p,callId:C}),i.info("sendStartCall() > create PeerConnection: ",C,p),n.next=30,h(l);case 30:return m=n.sent,y.updateLocalStream(m),!r&&a.isVideoEnabled||y.enableLocalVideo(!1),a.isAudioEnabled||y.enableLocalAudio(!1),i.info("sendStartCall() > getLocalPermission > updateLocalStream: ",m),de.setPeerConnectionClient(y),_e.updateMediaEnabledFromConstraints({call:f,constraints:{audio:a.isAudioEnabled,video:a.isVideoEnabled},isMine:!0}),Be.runOnStartSent(f,s),n.abrupt("return",f);case 41:throw n.prev=41,n.t0=n.catch(1),i.error("sendStartCall(): ",n.t0),n.t0;case 45:case"end":return n.stop()}},n,null,[[1,41]])}));return function(e){return n.apply(this,arguments)}}()},{key:"sendCandidate",value:function(){var n=Ne(regeneratorRuntime.mark(function n(t){var r,a,o,l,c,u;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=t.callId,a=t.candidate,n.prev=1,!(o=_e.getCall(r))){n.next=14;break}return n.next=6,e.getSendBirdGroupChannel(o.channelUrl);case 6:return l=n.sent,i.info("sendCandidate() > getChannel(): ",l),c=e.buildCandidate({callId:r,candidate:a}),n.next=11,e.send({channel:l,messageData:c,callId:r});case 11:return u=n.sent,i.info("sendCandidate() > sendMessage(): ",u),n.abrupt("return",u);case 14:n.next=20;break;case 16:throw n.prev=16,n.t0=n.catch(1),i.error("sendCandidate(): ",n.t0),n.t0;case 20:case"end":return n.stop()}},n,null,[[1,16]])}));return function(e){return n.apply(this,arguments)}}()},{key:"sendOfferCall",value:function(){var n=Ne(regeneratorRuntime.mark(function n(t){var r,a,o,l,c,u,s,d,f,v,p,C,y,m,g,b,E,w;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.call,a=t.callOptions,n.prev=1,o=r.isAudioCall,l=a.channelUrl,n.next=6,e.getSendBirdGroupChannel(l);case 6:return c=n.sent,i.info("sendOfferCall() > getChannel(): ",c),de.init(),u=r.callId,s=r._iceServers,d=new ye({iceServers:s,callId:u}),i.info("sendOfferCall() > create PeerConnection: ",u,s),f=a.getConstraints(o),n.next=16,h(f);case 16:return v=n.sent,d.updateLocalStream(v),!o&&a.isVideoEnabled||d.enableLocalVideo(!1),a.isAudioEnabled||d.enableLocalAudio(!1),i.info("sendOfferCall() > getLocalPermission > updateLocalStream: ",v),de.setPeerConnectionClient(d),p=d.peerConnection,n.prev=23,n.t0=p,n.next=27,p.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!o});case 27:return n.t1=n.sent,n.next=30,n.t0.setLocalDescription.call(n.t0,n.t1);case 30:n.next=36;break;case 32:n.prev=32,n.t2=n.catch(23),i.error("sendOfferCall() > createOffer + setLocalDescription: ",n.t2),W.throw(x.ACCEPTING_FAIL);case 36:return C=function(){var n=Ne(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:i.info("sendOfferCall() > timeout > sendTimeoutCall()"),e.sendTimeoutCall(r);case 2:case"end":return n.stop()}},n)}));return function(){return n.apply(this,arguments)}}(),ue.startTimer(z.SGNL,C),y=p.localDescription,m=e.buildOffer({callId:u,constraints:{audio:a.isAudioEnabled,video:a.isVideoEnabled},localDescription:y}),n.next=42,e.send({channel:c,messageData:m,callId:u});case 42:return g=n.sent,i.info("sendOfferCall() > sendMessage(): ",g),b=e.getPayloadFromUserMessage(g),E=_e.updateSignalCall(b),Ge.setActiveCall(E),i.info("sendOfferCall() > update Call: ",E),_e.updateMediaEnabledFromConstraints({call:r,constraints:{audio:a.isAudioEnabled,video:a.isVideoEnabled},isMine:!0}),Be.runOnAcceptSent(E),n.abrupt("return",E);case 53:throw n.prev=53,n.t3=n.catch(1),i.error("sendOfferCall(): ",n.t3),w=_e.getCall(w.callId),e.sendUnknownCall(w),n.t3;case 59:case"end":return n.stop()}},n,null,[[1,53],[23,32]])}));return function(e){return n.apply(this,arguments)}}()},{key:"sendAnswerCall",value:function(){var n=Ne(regeneratorRuntime.mark(function n(t){var r,a,o,l,c,u,s,d,f,v,h,p;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.call,a=t.channel,n.prev=1,o=r.callId,l=r.isAudioCall,c=de.getPeerConnectionClient(),u=c.peerConnection,n.t0=u,n.next=8,u.createAnswer({offerToReceiveAudio:!0,offerToReceiveVideo:!l});case 8:return n.t1=n.sent,n.next=11,n.t0.setLocalDescription.call(n.t0,n.t1);case 11:return s=u.localDescription,d=e.buildAnswer({callId:o,localDescription:s}),n.next=15,e.send({channel:a,messageData:d,callId:o});case 15:return f=n.sent,i.info("sendAnswerCall() > sendMessage(): ",f),v=e.getPayloadFromUserMessage(f),h=_e.updateSignalCall(v),i.info("sendAnswerCall() > update Call: ",h),n.abrupt("return",h);case 23:throw n.prev=23,n.t2=n.catch(1),i.error("sendAnswerCall(): ",n.t2),p=_e.getCall(p.callId),e.sendUnknownCall(p),n.t2;case 29:case"end":return n.stop()}},n,null,[[1,23]])}));return function(e){return n.apply(this,arguments)}}()},{key:"sendEndCall",value:function(){var n=Ne(regeneratorRuntime.mark(function n(t){var r,a,o,l,c,u,s,d,f,v,h;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.call,n.prev=1,a=r.callId,o=r.channelUrl,l=r.isAudioCall,c=r.state,n.next=5,e.getSendBirdGroupChannel(o);case 5:return u=n.sent,i.info("sendEndCall() > getChannel(): ",u),s=null,c===ne.CONNECTING?r.myRole===re.CALLER?s=e.buildCancel({callId:a,isAudioCall:l}):r.myRole===re.CALLEE?s=e.buildDecline({callId:a,isAudioCall:l}):W.throw(x.INVALID_ACTION):c===ne.CONNECTED?s=e.buildEnd({callId:a,isAudioCall:l}):c===ne.DISCONNECTED?W.throw(x.INVALID_ACTION):s=e.buildEnd({callId:a,isAudioCall:l}),n.next=11,e.send({channel:u,messageData:s,callId:a});case 11:return d=n.sent,i.info("sendEndCall() > sendMessage(): ",d),f=e.getPayloadFromUserMessage(d),v=_e.updateEndCall(f),(h=Ge.getActiveCall())&&h.callId===a&&Ge.removeActiveCall(a),i.info("sendEndCall() > update Call: ",v),Be.runOnEndSent(v,d),n.abrupt("return",v);case 22:throw n.prev=22,n.t0=n.catch(1),i.error("sendEndCall(): ",n.t0),n.t0;case 26:case"end":return n.stop()}},n,null,[[1,22]])}));return function(e){return n.apply(this,arguments)}}()},{key:"sendTimeoutCall",value:function(){var n=Ne(regeneratorRuntime.mark(function n(t){var r,a,o,l,c,u,s,d;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.callId,a=t.isAudioCall,o=t.channelUrl,n.prev=1,n.next=4,e.getSendBirdGroupChannel(o);case 4:return l=n.sent,i.info("sendTimeoutCall() > getChannel(): ",l),c=e.buildTimeout({callId:r,isAudioCall:a}),n.next=9,e.send({channel:l,messageData:c,callId:r});case 9:return u=n.sent,i.info("sendTimeoutCall() > sendMessage(): ",u),s=e.getPayloadFromUserMessage(u),d=_e.updateEndCall(s),Ge.removeActiveCall(r),i.info("sendTimeoutCall() > update Call: ",d),Be.runOnEndSent(d,u),n.abrupt("return",{});case 19:return n.prev=19,n.t0=n.catch(1),i.error("sendTimeoutCall(): ",n.t0),n.abrupt("return",{});case 23:case"end":return n.stop()}},n,null,[[1,19]])}));return function(e){return n.apply(this,arguments)}}()},{key:"sendUnknownCall",value:function(){var n=Ne(regeneratorRuntime.mark(function n(t){var r,a,o,l,c,u,s,d;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.callId,a=t.isAudioCall,o=t.channelUrl,n.prev=1,n.next=4,e.getSendBirdGroupChannel(o);case 4:return l=n.sent,i.info("sendUnknownCall() > getChannel(): ",l),c=e.buildUnknown({callId:r,isAudioCall:a}),n.next=9,e.send({channel:l,messageData:c,callId:r});case 9:return u=n.sent,i.info("sendUnknownCall() > sendMessage(): ",u),s=e.getPayloadFromUserMessage(u),d=_e.updateEndCall(s),Ge.removeActiveCall(r),i.info("sendUnknownCall() > update Call: ",d),Be.runOnEndSent(d,u),n.abrupt("return",{});case 19:return n.prev=19,n.t0=n.catch(1),i.error("sendUnknownCall(): ",n.t0),n.abrupt("return",{});case 23:case"end":return n.stop()}},n,null,[[1,19]])}));return function(e){return n.apply(this,arguments)}}()},{key:"sendVideoCall",value:function(){var n=Ne(regeneratorRuntime.mark(function n(t){var r,a,o,l,c,u,s,d;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.callId,a=t.isEnabled,n.prev=1,o=_e.getCall(r),n.next=5,e.getSendBirdGroupChannel(o.channelUrl);case 5:return l=n.sent,i.info("sendVideoCall() > getChannel(): ",l),c=e.buildVideo({callId:r,isEnabled:a}),n.next=10,e.send({channel:l,messageData:c,callId:r});case 10:return u=n.sent,i.info("sendVideoCall() > sendMessage(): ",u),s=e.getPayloadFromUserMessage(u),d=_e.updateSignalCall(s),i.info("sendVideoCall() > update Call: ",d),n.abrupt("return",d);case 18:n.prev=18,n.t0=n.catch(1),i.error("sendVideoCall(): ",n.t0);case 21:case"end":return n.stop()}},n,null,[[1,18]])}));return function(e){return n.apply(this,arguments)}}()},{key:"sendAudioCall",value:function(){var n=Ne(regeneratorRuntime.mark(function n(t){var r,a,o,l,c,u,s,d;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.callId,a=t.isEnabled,n.prev=1,o=_e.getCall(r),n.next=5,e.getSendBirdGroupChannel(o.channelUrl);case 5:return l=n.sent,i.info("sendAudioCall() > getChannel(): ",l),c=e.buildAudio({callId:r,isEnabled:a}),n.next=10,e.send({channel:l,messageData:c,callId:r});case 10:return u=n.sent,i.info("sendAudioCall() > sendMessage(): ",u),s=e.getPayloadFromUserMessage(u),d=_e.updateSignalCall(s),i.info("sendAudioCall() > update Call: ",d),n.abrupt("return",d);case 18:n.prev=18,n.t0=n.catch(1),i.error("sendAudioCall(): ",n.t0);case 21:case"end":return n.stop()}},n,null,[[1,18]])}));return function(e){return n.apply(this,arguments)}}()},{key:"isVideoChatMessage",value:function(e){return e&&e.isUserMessage()&&e.customType.indexOf(Z)>-1&&e.data&&Object.values(z).indexOf(e.data.substring(0,4))>-1}},{key:"getPayloadFromUserMessage",value:function(n){var t=null;if(e.isVideoChatMessage(n)){var r=n.data.substring(0,4),a=JSON.parse(n.data.substring(4));t=v({},{cmd:r},a,{message_id:n.messageId,channel_url:n.channelUrl})}return t}},{key:"addDefaultPayload",value:function(e){return e.videochat_protocol_ver=1,e}},{key:"buildStart",value:function(n){var t=n.constraints,r=n.isAudioCall,a={type:J.START,constraints:t,is_audio_call:r};return a=e.addDefaultPayload(a),z.STCA+JSON.stringify(a)}},{key:"buildEnd",value:function(n){var t=n.callId,r=n.isAudioCall,a={type:X.END,call_id:t,is_audio_call:r};return a=e.addDefaultPayload(a),z.ENCA+JSON.stringify(a)}},{key:"buildDecline",value:function(n){var t=n.callId,r=n.isAudioCall,a={type:X.DECLINE,call_id:t,is_audio_call:r};return a=e.addDefaultPayload(a),z.ENCA+JSON.stringify(a)}},{key:"buildCancel",value:function(n){var t=n.callId,r=n.isAudioCall,a={type:X.CANCEL,call_id:t,is_audio_call:r};return a=e.addDefaultPayload(a),z.ENCA+JSON.stringify(a)}},{key:"buildTimeout",value:function(n){var t=n.callId,r=n.isAudioCall,a={type:X.TIMEOUT,call_id:t,is_audio_call:r};return a=e.addDefaultPayload(a),z.ENCA+JSON.stringify(a)}},{key:"buildUnknown",value:function(n){var t=n.callId,r=n.isAudioCall,a={type:X.UNKNOWN,call_id:t,is_audio_call:r};return a=e.addDefaultPayload(a),z.ENCA+JSON.stringify(a)}},{key:"buildOffer",value:function(n){var t=n.callId,r=n.constraints,a=n.localDescription;try{var o={type:K.OFFER,sdp:P(a.sdp),call_id:t,constraints:r};return o=e.addDefaultPayload(o),z.SGNL+JSON.stringify(o)}catch(e){throw i.error("buildOffer: ",e),e}}},{key:"buildAnswer",value:function(n){var t=n.callId,r=n.localDescription;try{var a={type:K.ANSWER,sdp:P(r.sdp),call_id:t};return a=e.addDefaultPayload(a),z.SGNL+JSON.stringify(a)}catch(n){i.error("buildAnswer: ",n);var o=_e.getCall(t);e.sendUnknownCall(o).then(function(e){i.info("buildAnswer > error > sendUnknownCall(): ",e);var n=e.call,t=e.message;Be.runOnEndSent(n,t)}).catch(function(e){return i.error("buildAnswer > error > sendUnknownCall(): ",e)})}}},{key:"buildCandidate",value:function(n){var t=n.callId,r=n.candidate,a={type:K.CANDIDATE,sdp:r.candidate,sdp_mline_index:r.sdpMLineIndex,sdp_mid:r.sdpMid,call_id:t};return a=e.addDefaultPayload(a),z.SGNL+JSON.stringify(a)}},{key:"buildVideo",value:function(n){var t=n.callId,r=n.isEnabled,a={type:K.VIDEO,call_id:t,is_enabled:r};return a=e.addDefaultPayload(a),z.SGNL+JSON.stringify(a)}},{key:"buildAudio",value:function(n){var t=n.callId,r=n.isEnabled,a={type:K.AUDIO,call_id:t,is_enabled:r};return a=e.addDefaultPayload(a),z.SGNL+JSON.stringify(a)}}],t&&Re(n.prototype,t),r&&Re(n,r),e}();function Pe(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function De(e,n,t,r,a,o,i){try{var l=e[o](i),c=l.value}catch(e){return void t(e)}l.done?n(c):Promise.resolve(c).then(r,a)}function xe(e){return function(){var n=this,t=arguments;return new Promise(function(r,a){var o=e.apply(n,t);function i(e){De(o,r,a,i,l,"next",e)}function l(e){De(o,r,a,i,l,"throw",e)}i(void 0)})}}var Le=function(){var e=xe(regeneratorRuntime.mark(function e(n){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{i.info("processStart: ",n),n.state=ne.CONNECTING,n.role=re.CALLEE,t=new Se({payload:n}),r=n.constraints,_e.updateMediaEnabledFromConstraints({call:t,constraints:r,isMine:!1}),_e.addCall(t),Be.runOnStartReceived(t)}catch(e){i.error("processStart: ",e)}case 1:case"end":return e.stop()}},e)}));return function(n){return e.apply(this,arguments)}}(),Ve=function(){var e=xe(regeneratorRuntime.mark(function e(n,t){var r,a,o,l,c,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i.info("processOffer(): ",n),e.prev=1,ue.stopTimer(),r=_e.updateSignalCall(n),a=n.constraints,_e.updateMediaEnabledFromConstraints({call:r,constraints:a,isMine:!1}),o=de.getPeerConnectionClient(),l=o.peerConnection,c={type:n.type,sdp:D(n.sdp)},e.next=11,l.setRemoteDescription(c);case 11:return e.next=13,Te.sendAnswerCall({call:r,channel:t});case 13:u=e.sent,i.info("sendAnswerCall: ",u),Be.runOnAcceptReceived(u),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(1),i.error("processOffer: ",e.t0),Te.sendUnknownCall({callId:n.call_id,isAudioCall:n.is_audio_call,channelUrl:n.channel_url});case 22:case"end":return e.stop()}},e,null,[[1,18]])}));return function(n,t){return e.apply(this,arguments)}}(),Ue=function(){var e=xe(regeneratorRuntime.mark(function e(n){var t,r,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i.info("processAnswer(): ",n),e.prev=1,ue.stopTimer(),_e.updateSignalCall(n),t=de.getPeerConnectionClient(),r=t.peerConnection,a={type:n.type,sdp:D(n.sdp)},e.next=9,r.setRemoteDescription(a);case 9:e.next=15;break;case 11:e.prev=11,e.t0=e.catch(1),i.error("processAnswer: ",e.t0),Te.sendUnknownCall({callId:n.call_id,isAudioCall:n.is_audio_call,channelUrl:n.channel_url});case 15:case"end":return e.stop()}},e,null,[[1,11]])}));return function(n){return e.apply(this,arguments)}}(),Me=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,r;return n=e,r=[{key:"init",value:function(){e.handlers={}}},{key:"addSendBirdChannelHandler",value:function(n){var t=Ge.getSendBird(),r=new t.ChannelHandler;r.onMessageReceived=function(e,n){if(i.info("onMessageReceived(): ",e,n),Te.isVideoChatMessage(n)){var t=Te.getPayloadFromUserMessage(n);i.info("onMessageReceived() > payload: ",t);var r=_e.getCall(t.call_id),a=!!r&&r.channelUrl===e.url;switch(r&&a&&_e.updateCallerCallee({callId:t.call_id,sender:n.sender}),t.cmd){case z.STCA:Le(t);break;case z.ENCA:!function(e,n){try{i.info("processEnd(): ",e);var t=_e.updateEndCall(e);n&&(ue.stopTimer(),Ge.removeActiveCall(t.callId),de.init()),Be.runOnEndReceived(t)}catch(e){i.info("processEnd: ",e)}}(t,a);break;case z.SGNL:var o=t.type;o===K.OFFER?Ve(t,e):o===K.ANSWER?Ue(t):o===K.CANDIDATE?function(e){i.info("processCandidate()");var n=de.getPeerConnectionClient(),t={candidate:e.sdp,sdpMLineIndex:e.sdp_mline_index,sdpMid:e.sdp_mid},r=new RTCIceCandidate(t);n.peerConnection.addIceCandidate(r).then(function(){return i.info("addIceCandidate() succeed")}).catch(function(e){return i.error("addIceCandidate() failed: ",e)})}(t):o===K.AUDIO?function(e){var n=_e.updateSignalCall(e);i.info("processAudio() > update Call: ",n),Be.runOnOpponentAudioStateChanged(n)}(t):o===K.VIDEO?function(e){var n=_e.updateSignalCall(e);i.info("processVideo() > update Call: ",n),Be.runOnOpponentVideoStateChanged(n)}(t):i.info("onMessageReceived(): SGNL.type is not valid: ",o);break;default:i.info("onMessageReceived(): CMD is not valid: ",t.cmd)}}},t.addChannelHandler(n,r),e.handlers[n]=r,i.info("addSendBirdChannelHandler(): ",n)}},{key:"removeSendBirdChannelHandler",value:function(n){var t=Ge.getSendBird();n.forEach(function(n){delete e.handlers[n],t.removeChannelHandler(n)}),i.info("removeSendBirdChannelHandler(): ",n)}}],(t=null)&&Pe(n.prototype,t),r&&Pe(n,r),e}();function je(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Me.handlers={};var Be=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,r;return n=e,r=[{key:"init",value:function(){e.handlers={},Me.removeSendBirdChannelHandler(["SENDBIRD_HANDLER_IDENTIFIER_VIDEOCHAT"])}},{key:"add",value:function(n,t){e.handlers[n]=t,Me.addSendBirdChannelHandler("SENDBIRD_HANDLER_IDENTIFIER_VIDEOCHAT")}},{key:"remove",value:function(n){delete e.handlers[n]}},{key:"runOnStartSent",value:function(n,t){for(var r in e.handlers)e.handlers.hasOwnProperty(r)&&e.handlers[r].onStartSent(n,t)}},{key:"runOnStartReceived",value:function(n){for(var t in e.handlers)e.handlers.hasOwnProperty(t)&&e.handlers[t].onStartReceived(n)}},{key:"runOnAcceptSent",value:function(n){for(var t in e.handlers)e.handlers.hasOwnProperty(t)&&e.handlers[t].onAcceptSent(n)}},{key:"runOnAcceptReceived",value:function(n){for(var t in e.handlers)e.handlers.hasOwnProperty(t)&&e.handlers[t].onAcceptReceived(n)}},{key:"runOnEndSent",value:function(n,t){for(var r in e.handlers)e.handlers.hasOwnProperty(r)&&e.handlers[r].onEndSent(n,t)}},{key:"runOnEndReceived",value:function(n){for(var t in e.handlers)e.handlers.hasOwnProperty(t)&&e.handlers[t].onEndReceived(n)}},{key:"runOnConnected",value:function(n){for(var t in e.handlers)e.handlers.hasOwnProperty(t)&&e.handlers[t].onConnected(n)}},{key:"runOnOpponentAudioStateChanged",value:function(n){for(var t in e.handlers)e.handlers.hasOwnProperty(t)&&e.handlers[t].onOpponentAudioStateChanged(n)}},{key:"runOnOpponentVideoStateChanged",value:function(n){for(var t in e.handlers)e.handlers.hasOwnProperty(t)&&e.handlers[t].onOpponentVideoStateChanged(n)}}],(t=null)&&je(n.prototype,t),r&&je(n,r),e}();function Fe(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Be.handlers={};var Ge=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,r;return n=e,r=[{key:"setActiveCall",value:function(n){e.activeCallId=n.callId,_e.addCall(n)}},{key:"getActiveCall",value:function(){return _e.getCall(e.activeCallId)}},{key:"removeActiveCall",value:function(n){e.activeCallId="",_e.removeCall(n)}},{key:"setStartCallTimeout",value:function(n){e.startCallTimeout=n}},{key:"getStartCallTimeout",value:function(){return 0===e.startCallTimeout?30:this.startCallTimeout}},{key:"setSendBird",value:function(n){e.sendBird=n}},{key:"getSendBird",value:function(){return e.sendBird}}],(t=null)&&Fe(n.prototype,t),r&&Fe(n,r),e}();Ge.sendBird=null,Ge.remoteVideoElement=null,Ge.localVideoElement=null,Ge.startCallTimeout=0,Ge.activeCallId="";var He={CHAT:"chat",START:"start",END:"end",NOT_RENDER:"not_render"};function We(e,n,t,r,a,o,i){try{var l=e[o](i),c=l.value}catch(e){return void t(e)}l.done?n(c):Promise.resolve(c).then(r,a)}function Qe(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Je=null,Xe=function(){function e(n){var t=n.sendBird,r=void 0===t?null:t;if(function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),Je)return Je;r?(Ge.setSendBird(r),Je=this):(i.error("SendBirdVideoChat constructor: ",x.SENDBIRD_REQUIRED.code),W.throw(x.SENDBIRD_REQUIRED))}var n,t,r;return n=e,t=null,r=[{key:"init",value:function(n){var t=n.sendBird;if(i.messagePrefix="[SBVC] ",t){var r=new e({sendBird:t});return i.info("SendBirdVideoChat SDK is initialized."),r}i.error("SendBirdVideoChat init: ",x.SENDBIRD_REQUIRED.code),W.throw(x.SENDBIRD_REQUIRED)}},{key:"addVideoChatHandler",value:function(e,n){e&&s(e)&&n instanceof Q&&(i.info("addVideoChatHandler(): ",e),Be.add(e,n))}},{key:"removeVideoChatHandler",value:function(e){e&&s(e)&&(i.info("removeVideoChatHandler(): ",e),Be.remove(e))}},{key:"removeAllVideoChatHandlers",value:function(){i.info("removeAllVideoChatHandlers()"),Be.init()}},{key:"startCall",value:function(){var e,n=(e=regeneratorRuntime.mark(function e(n,t,r){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,Te.isConnectedToSendBird()||W.throw(x.SENDBIRD_CONNECTION_REQUIRED),c(n)&&ee.isCallOptions(t)&&s(t.channelUrl)||W.throw(x.INVALID_PARAMETER),Ge.getActiveCall()&&W.throw(x.INVALID_ACTION),Ge.remoteVideoElement=t.remoteVideoElement,Ge.localVideoElement=t.localVideoElement,e.next=8,Te.sendStartCall({isAudioCall:n,callOptions:t});case 8:return a=e.sent,i.info("startCall(): ",t,a),e.abrupt("return",f(r,null,a));case 13:return e.prev=13,e.t0=e.catch(0),i.error("startCall(): ",e.t0),e.abrupt("return",f(r,e.t0));case 17:case"end":return e.stop()}},e,null,[[0,13]])}),function(){var n=this,t=arguments;return new Promise(function(r,a){var o=e.apply(n,t);function i(e){We(o,r,a,i,l,"next",e)}function l(e){We(o,r,a,i,l,"throw",e)}i(void 0)})});return function(e,t,r){return n.apply(this,arguments)}}()},{key:"buildCall",value:function(e){try{i.info("buildCall(): ",e);var n=Te.getPayloadFromUserMessage(e);return n?new Se({payload:n}):null}catch(n){return i.error("buildCall(): ",n,e),null}}},{key:"getCall",value:function(e){return _e.getCall(e)}},{key:"getActiveCall",value:function(){return Ge.getActiveCall()}},{key:"setStartCallTimeout",value:function(e){u(e)&&e>=30&&e<=60&&Ge.setStartCallTimeout(e)}},{key:"getStartCallTimeout",value:function(){return Ge.getStartCallTimeout()}},{key:"getRenderingMessageType",value:function(e){var n=He.NOT_RENDER;try{if((e.isFileMessage()||e.isAdminMessage()||e.isUserMessage())&&(n=He.CHAT),Te.isVideoChatMessage(e)){var t=e.data.substring(0,4);n=t===z.STCA?He.START:t===z.ENCA?He.END:He.NOT_RENDER}}catch(e){n=He.NOT_RENDER}return n}},{key:"setLogLevel",value:function(e){i.level=e}},{key:"sendBird",get:function(){return Ge.getSendBird()}},{key:"VERSION",get:function(){return"0.9.0"}}],t&&Qe(n.prototype,t),r&&Qe(n,r),e}();Xe.VideoChatHandler=Q,Xe.CallOptions=ee,Xe.VideoChatException=W;var Ke={RenderingMessageType:He,EndType:te,Role:re};Xe.VideoChatType=Ke;n.default=Xe}]).default});